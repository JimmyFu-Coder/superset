"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[8149],{40730:(e,t,a)=>{a.d(t,{Z:()=>Ae});var n,o=a(28216),r=a(14890),l=a(52256),i=a(97381),s=a(73126),d=a(45697),c=a.n(d),u=a(67294),h=a(61988),p=a(51995),m=a(93185),g=a(68492),b=a(55786),Z=a(9531),v=a(38703),f=a(94301),y=a(57902),C=a(3741),S=a(27600),x=a(23525),_=a(71894);!function(e){e.Explore="explore",e.Dashboard="dashboard"}(n||(n={}));var M,T=a(42190),w=a(50361),I=a.n(w),k=a(18446),D=a.n(k),F=a(11865),E=a.n(F),R=a(16355),$=a(11064),N=a(88274),O=a(70917),A=a(90731),L=a(12617),U=a(83862),z=a(4715),q=a(74599),j=a(41814),V=a(69175),B=a(15856),P=a(70707),H=a(9875),Q=a(14114),Y=a(6412),K=a(37731),G=a(73727),W=a(74069),X=a(35932),J=a(57001),ee=a(40219),te=a(99232),ae=a(53579),ne=a(29487);function oe({formData:e,result:t,dataset:a,onContextMenu:n,inContextMenu:o}){const r=(0,u.useMemo)((()=>({onContextMenu:n})),[n]);return(0,O.tZ)("div",{css:O.iv`
        width: 100%;
        height: 100%;
        min-height: 0;
      `},(0,O.tZ)(N.Z,{disableErrorBoundary:!0,chartType:e.viz_type,enableNoResults:!0,datasource:a,formData:e,queriesData:t,hooks:r,inContextMenu:o,height:"100%",width:"100%"}))}!function(e){e[e.Chart=0]="Chart",e[e.Table=1]="Table"}(M||(M={}));var re=a(87183),le=a(54076);const ie=(0,p.iK)(z.O5.Item)`
  ${({theme:e,isClickable:t})=>O.iv`
    cursor: ${t?"pointer":"auto"};
    color: ${e.colors.grayscale.light1};
    transition: color ease-in ${e.transitionTiming}s;
    .ant-breadcrumb > span:last-child > & {
      color: ${e.colors.grayscale.dark1};
    }
    &:hover {
      color: ${t?e.colors.grayscale.dark1:"inherit"};
    }
  `}
`;var se=a(5462),de=a(71262);const ce=p.iK.div`
  ${({theme:e})=>O.iv`
    & .pagination-container {
      bottom: ${4*-e.gridUnit}px;
    }
  `}
`,ue="adhoc_filters",he=({formData:e,closeModal:t})=>{const a=(0,o.I0)(),{addDangerToast:n}=(0,Q.e1)(),[r,l]=(0,u.useState)(""),s=(0,u.useContext)(J.DashboardPageIdContext),d=(0,u.useCallback)((()=>{a((0,i.logEvent)(C.qL,{slice_id:e.slice_id}))}),[a,e.slice_id]),[c,p]=e.datasource.split("__");return(0,u.useEffect)((()=>{(0,ee.nv)(Number(c),p,e,0).then((e=>{l(`/explore/?form_data_key=${e}&dashboard_page_id=${s}`)})).catch((()=>{n((0,h.t)("Failed to generate chart edit URL"))}))}),[n,s,c,p,e]),(0,O.tZ)(u.Fragment,null,(0,O.tZ)(X.Z,{buttonStyle:"secondary",buttonSize:"small",onClick:d,disabled:!r},(0,O.tZ)(G.rU,{css:O.iv`
            &:hover {
              text-decoration: none;
            }
          `,to:r},(0,h.t)("Edit chart"))),(0,O.tZ)(X.Z,{buttonStyle:"primary",buttonSize:"small",onClick:t},(0,h.t)("Close")))};function pe({column:e,dataset:t,drillByConfig:a,formData:n,onHideModal:r}){const s=(0,o.I0)(),d=(0,p.Fg)(),{addDangerToast:c}=(0,Q.e1)(),[m,g]=(0,u.useState)(!0),[Z,f]=(0,u.useState)([{...a,column:e}]);(0,u.useEffect)((()=>{s((0,i.logEvent)(C.zf,{slice_id:n.slice_id}))}),[s,n.slice_id]);const{column:y,groupbyFieldName:S=a.groupbyFieldName}=Z[Z.length-1]||{},x=(0,u.useMemo)((()=>(0,b.Z)(n[S]).map((e=>{var a;return null==(a=t.columns)?void 0:a.find((t=>t.column_name===e))})).filter(K.Z)),[t.columns,n,S]),{displayModeToggle:_,drillByDisplayMode:T}=(()=>{const[e,t]=(0,u.useState)(M.Chart);return{displayModeToggle:(0,u.useMemo)((()=>(0,O.tZ)("div",{css:e=>O.iv`
          margin-bottom: ${6*e.gridUnit}px;
          .ant-radio-button-wrapper-checked:not(.ant-radio-button-wrapper-disabled):focus-within {
            box-shadow: none;
          }
        `},(0,O.tZ)(re.Y.Group,{onChange:({target:{value:e}})=>{t(e)},defaultValue:M.Chart},(0,O.tZ)(re.Y.Button,{value:M.Chart},(0,h.t)("Chart")),(0,O.tZ)(re.Y.Button,{value:M.Table},(0,h.t)("Table"))))),[]),drillByDisplayMode:e}})(),[w,I]=(0,u.useState)(),k=((e,t)=>(0,K.Z)(e)?1===e.length?(0,O.tZ)(ce,null,(0,O.tZ)(se.T,{colnames:e[0].colnames,coltypes:e[0].coltypes,data:e[0].data,dataSize:15,datasourceId:t,isVisible:!0})):(0,O.tZ)(de.ZP,{fullWidth:!1},e.map(((e,a)=>(0,O.tZ)(de.ZP.TabPane,{tab:(0,h.t)("Results %s",a+1),key:a},(0,O.tZ)(ce,null,(0,O.tZ)(se.T,{colnames:e.colnames,coltypes:e.coltypes,data:e.data,dataSize:15,datasourceId:t,isVisible:!0})))))):(0,O.tZ)("div",null))(w,n.datasource),[D,F]=(0,u.useState)(n),[E,R]=(0,u.useState)([...x,e].filter(K.Z)),[$,N]=(0,u.useState)([{groupby:x,filters:a.filters},{groupby:e||[]}]),A=(0,u.useCallback)(((e,t=S)=>Array.isArray(n[t])?[e.column_name]:e.column_name),[n,S]),L=(0,u.useCallback)((e=>e.reduce(((e,t)=>{null!=t&&t.groupbyFieldName&&t.column&&(e.formData[t.groupbyFieldName]=A(t.column,t.groupbyFieldName),e.overridenGroupbyFields.add(t.groupbyFieldName));const a=(null==t?void 0:t.adhocFilterFieldName)||ue;return e.formData[a]=[...(0,b.Z)(e[a]),...(0,b.Z)(t.filters).map((e=>(0,te.f)(e)))],e.overridenAdhocFilterFields.add(a),e}),{formData:{},overridenGroupbyFields:new Set,overridenAdhocFilterFields:new Set})),[A]),U=(0,u.useCallback)((()=>Z.reduce(((e,t)=>{const a=t.adhocFilterFieldName||ue;return e[a]=[...e[a]||[],...t.filters.map((e=>(0,te.f)(e)))],e}),{})),[Z]),q=((e,t=le.EI)=>(0,u.useMemo)((()=>{const a=t=>t<e.length-1;return(0,O.tZ)(z.O5,{css:e=>O.iv`
          margin: ${2*e.gridUnit}px 0 ${4*e.gridUnit}px;
        `},e.map(((e,n)=>(0,O.tZ)(ie,{key:n,isClickable:a(n),onClick:a(n)?()=>t(e,n):le.EI},(e=>`${(0,b.Z)(e.groupby).map((e=>e.verbose_name||e.column_name)).join(", ")} ${e.filters?`(${e.filters.map((e=>e.formattedVal||e.val)).join(", ")})`:""}`)(e)))))}),[e,t]))($,(0,u.useCallback)(((e,t)=>{s((0,i.logEvent)(C.TG,{slice_id:n.slice_id})),f((e=>e.slice(0,t))),N((e=>{const a=e.slice(0,t+1);return delete a[a.length-1].filters,a})),R((e=>e.slice(0,t))),F((()=>{if(0===t)return n;const{formData:e,overridenAdhocFilterFields:a}=L(Z.slice(0,t)),o={...n,...e};return a.forEach((t=>({...o,[t]:[...n[t],...e[t]]}))),o}))}),[s,Z,n,L])),j=(0,u.useMemo)((()=>{let e={...D};y&&S&&(e[S]=A(y));const t=U();return Object.keys(t).forEach((a=>{e={...e,[a]:[...(0,b.Z)(n[a]),...t[a]]}})),e.slice_id=0,delete e.slice_name,delete e.dashboards,e}),[D,y,S,U,A,n]);(0,u.useEffect)((()=>{R((e=>!y||e.some((e=>e.column_name===y.column_name))?e:[...e,y]))}),[y]);const V=(0,u.useCallback)(((e,t)=>{s((0,i.logEvent)(C.g3,{drill_depth:Z.length+1,slice_id:n.slice_id})),F(j),f((a=>[...a,{...t,column:e}])),N((a=>{const n=[...a,{groupby:e}];return n[n.length-2].filters=t.filters,n}))}),[s,Z.length,j,n.slice_id]),B=(0,u.useMemo)((()=>({drillBy:{excludedColumns:E,openNewModal:!1}})),[E]),{contextMenu:P,inContextMenu:H,onContextMenu:Y}=((e,t,a,n,o)=>{const r=(0,u.useRef)(null),[l,i]=(0,u.useState)(!1),s=(0,u.useCallback)(((...e)=>{i(!1),null==a||a(...e)}),[a]),d=(0,u.useCallback)((()=>{i(!1)}),[]);return{contextMenu:(0,u.useMemo)((()=>(0,O.tZ)(ve,{ref:r,id:0,formData:t,onSelection:s,onClose:d,displayedItems:n,additionalConfig:o})),[o,0,n,t,d,s]),inContextMenu:l,onContextMenu:(e,t,a)=>{var n;null==(n=r.current)||n.open(e,t,a),i(!0)}}})(0,D,V,be.DrillBy,B),G=(0,o.v9)((e=>{const t=Object.values(e.dashboardLayout.present).find((e=>{var t;return(null==(t=e.meta)?void 0:t.chartId)===n.slice_id}));return(null==t?void 0:t.meta.sliceNameOverride)||(null==t?void 0:t.meta.sliceName)}));(0,u.useEffect)((()=>{j&&(g(!0),I(void 0),(0,l.getChartDataRequest)({formData:j}).then((({json:e})=>{I(e.result)})).catch((()=>{c((0,h.t)("Failed to load chart data."))})).finally((()=>{g(!1)})))}),[c,j]);const{metadataBar:X}=(0,ae.S)({dataset:t});return(0,O.tZ)(W.default,{css:O.iv`
        .ant-modal-footer {
          border-top: none;
        }
      `,show:!0,onHide:null!=r?r:()=>null,title:(0,h.t)("Drill by: %s",G),footer:(0,O.tZ)(he,{formData:j}),responsive:!0,resizable:!0,resizableConfig:{minHeight:128*d.gridUnit,minWidth:128*d.gridUnit,defaultSize:{width:"auto",height:"80vh"}},draggable:!0,destroyOnClose:!0,maskClosable:!1},(0,O.tZ)("div",{css:O.iv`
          display: flex;
          flex-direction: column;
          height: 100%;
        `},X,q,_,m&&(0,O.tZ)(v.Z,null),!m&&!w&&(0,O.tZ)(ne.Z,{type:"error",message:(0,h.t)("There was an error loading the chart data")}),T===M.Chart&&w&&(0,O.tZ)(oe,{dataset:t,formData:j,result:w,onContextMenu:Y,inContextMenu:H}),T===M.Table&&w&&k,P))}var me=a(46219);const ge=({drillByConfig:e,formData:t,contextMenuY:a=0,submenuIndex:n=0,onSelection:o=(()=>{}),onClick:r=(()=>{}),excludedColumns:l,openNewModal:i=!0,...d})=>{const c=(0,p.Fg)(),{addDangerToast:m}=(0,Q.e1)(),[g,Z]=(0,u.useState)(!0),[f,y]=(0,u.useState)(""),[C,S]=(0,u.useState)(),[x,_]=(0,u.useState)([]),[M,T]=(0,u.useState)(!1),[w,I]=(0,u.useState)(),k=(0,u.useCallback)(((t,a)=>{r(t),o(a,e),I(a),i&&T(!0)}),[e,r,o,i]),D=(0,u.useCallback)((()=>{T(!1)}),[]);(0,u.useEffect)((()=>{y("")}),[x.length]);const F=(0,b.Z)(null==e?void 0:e.filters).length&&(null==e?void 0:e.groupbyFieldName),E=(0,u.useMemo)((()=>{var e;return null==(e=(0,$.Z)().get(t.viz_type))?void 0:e.behaviors.find((e=>e===R.cg.DRILL_BY))}),[t.viz_type]),N=(e=>{const t={};return(0,b.Z)(null==e?void 0:e.columns).forEach((e=>{t[e.column_name]=e.verbose_name||e.column_name})),(0,b.Z)(null==e?void 0:e.metrics).forEach((e=>{t[e.metric_name]=e.verbose_name||e.metric_name})),t})(C);(0,u.useEffect)((()=>{if(E&&F){const a=t.datasource.split("__")[0];(0,Y.e)({endpoint:`/api/v1/dataset/${a}`}).then((({json:{result:a}})=>{S(a),_((0,b.Z)(a.columns).filter((e=>e.groupby)).filter((a=>{var n,o;return!(0,b.Z)(t[null!=(n=e.groupbyFieldName)?n:""]).includes(a.column_name)&&a.column_name!==t.x_axis&&(null==(o=(0,b.Z)(l))?void 0:o.every((e=>e.column_name!==a.column_name)))})))})).catch((()=>{Y.f.delete(`/api/v1/dataset/${a}`),m((0,h.t)("Failed to load dimensions for drill by"))})).finally((()=>{Z(!1)}))}}),[m,l,t,null==e?void 0:e.groupbyFieldName,E,F]);const A=(0,u.useCallback)((e=>{var t;e.stopPropagation();const a=null==e||null==(t=e.target)?void 0:t.value;y(a)}),[]),L=(0,u.useMemo)((()=>x.filter((e=>(e.verbose_name||e.column_name).toLowerCase().includes(f.toLowerCase())))),[x,f]),z=(0,u.useMemo)((()=>(0,V.th)(a,L.length||1,n,200,x.length>10?48:0)),[a,L.length,n,x.length]);let q;return E?F||(q=(0,h.t)("Drill by is not available for this data point")):q=(0,h.t)("Drill by is not yet supported for this chart type"),E&&F?(0,O.tZ)(u.Fragment,null,(0,O.tZ)(U.Menu.SubMenu,(0,s.Z)({title:(0,h.t)("Drill by"),key:"drill-by-submenu",popupClassName:"chart-context-submenu",popupOffset:[0,z]},d),(0,O.tZ)("div",null,x.length>10&&(0,O.tZ)(H.II,{prefix:(0,O.tZ)(P.Z.Search,{iconSize:"l",iconColor:c.colors.grayscale.light1}),onChange:A,placeholder:(0,h.t)("Search columns"),value:f,onClick:e=>{e.nativeEvent.stopImmediatePropagation()},allowClear:!0,css:O.iv`
                width: auto;
                max-width: 100%;
                margin: ${2*c.gridUnit}px ${3*c.gridUnit}px;
                box-shadow: none;
              `}),g?(0,O.tZ)("div",{css:O.iv`
                padding: ${3*c.gridUnit}px 0;
              `},(0,O.tZ)(v.Z,{position:"inline-centered"})):L.length?(0,O.tZ)("div",{css:O.iv`
                max-height: ${200}px;
                overflow: auto;
              `},L.map((e=>(0,O.tZ)(me.i,(0,s.Z)({key:`drill-by-item-${e.column_name}`,tooltipText:e.verbose_name||e.column_name},d,{onClick:t=>k(t,e)}),e.verbose_name||e.column_name)))):(0,O.tZ)(U.Menu.Item,(0,s.Z)({disabled:!0,key:"no-drill-by-columns-found"},d),(0,h.t)("No columns found")))),M&&(0,O.tZ)(pe,{column:w,drillByConfig:e,formData:t,onHideModal:D,dataset:{...C,verbose_map:N}})):(0,O.tZ)(U.Menu.Item,(0,s.Z)({key:"drill-by-disabled",disabled:!0},d),(0,O.tZ)("div",null,(0,h.t)("Drill by"),(0,O.tZ)(B.j,{title:q})))};var be;!function(e){e[e.CrossFilter=0]="CrossFilter",e[e.DrillToDetail=1]="DrillToDetail",e[e.DrillBy=2]="DrillBy",e[e.All=3]="All"}(be||(be={}));const Ze=({id:e,formData:t,onSelection:a,onClose:n,displayedItems:r=be.All,additionalConfig:l},i)=>{var d,c;const g=(0,p.Fg)(),Z=(0,o.I0)(),v=(0,o.v9)((e=>{var t;return(0,L.R)("can_explore","Superset",null==(t=e.user)?void 0:t.roles)})),f=(0,o.v9)((({dashboardInfo:e})=>e.crossFiltersEnabled)),y=e=>r===be.All||(0,b.Z)(r).includes(e),[{filters:C,clientX:S,clientY:x},_]=(0,u.useState)({clientX:0,clientY:0}),M=[],T=(0,m.cr)(m.TT.DRILL_TO_DETAIL)&&v&&y(be.DrillToDetail),w=(0,m.cr)(m.TT.DRILL_BY)&&v&&y(be.DrillBy),I=(0,m.cr)(m.TT.DASHBOARD_CROSS_FILTERS)&&y(be.CrossFilter),k=null==(d=(0,$.Z)().get(t.viz_type))||null==(c=d.behaviors)?void 0:c.includes(R.cg.INTERACTIVE_CHART);let D=0;if(I&&(D+=1),T&&(D+=2),w&&(D+=1),0===D&&(D=1),I){var F;const t=!k||!f||!(null!=C&&C.crossFilter);let a=null;t?f?k?null!=C&&C.crossFilter||(a=(0,O.tZ)(u.Fragment,null,(0,O.tZ)("div",null,(0,h.t)("You can't apply cross-filter on this data point.")))):a=(0,O.tZ)(u.Fragment,null,(0,O.tZ)("div",null,(0,h.t)("This visualization type does not support cross-filtering."))):a=(0,O.tZ)(u.Fragment,null,(0,O.tZ)("div",null,(0,h.t)("Cross-filtering is not enabled for this dashboard."))):a=(0,O.tZ)(u.Fragment,null,(0,O.tZ)("div",null,(0,h.t)("Cross-filter will be applied to all of the charts that use this dataset.")),(0,O.tZ)("div",null,(0,h.t)("You can also just click on the chart to apply cross-filter."))),M.push((0,O.tZ)(u.Fragment,null,(0,O.tZ)(U.Menu.Item,{key:"cross-filtering-menu-item",disabled:t,onClick:()=>{null!=C&&C.crossFilter&&Z((0,q.eG)(e,C.crossFilter.dataMask))}},null!=C&&null!=(F=C.crossFilter)&&F.isCurrentValueSelected?(0,h.t)("Remove cross-filter"):(0,O.tZ)("div",null,(0,h.t)("Add cross-filter"),(0,O.tZ)(B.j,{title:a,color:t?void 0:g.colors.grayscale.base}))),D>1&&(0,O.tZ)(U.Menu.Divider,null)))}if(T&&M.push((0,O.tZ)(j.p,(0,s.Z)({chartId:e,formData:t,filters:null==C?void 0:C.drillToDetail,isContextMenu:!0,contextMenuY:x,onSelection:a,submenuIndex:I?2:1},(null==l?void 0:l.drillToDetail)||{}))),w){let e=0;I&&(e+=1),T&&(e+=2),M.push((0,O.tZ)(ge,(0,s.Z)({drillByConfig:null==C?void 0:C.drillBy,onSelection:a,formData:t,contextMenuY:x,submenuIndex:e},(null==l?void 0:l.drillBy)||{})))}const E=(0,u.useCallback)(((t,a,n)=>{var o;const r=(0,V.$t)(a,D);_({clientX:t,clientY:r,filters:n}),null==(o=document.getElementById(`hidden-span-${e}`))||o.click()}),[e,D]);return(0,u.useImperativeHandle)(i,(()=>({open:E})),[E]),A.createPortal((0,O.tZ)(z.Gj,{overlay:(0,O.tZ)(U.Menu,{className:"chart-context-menu"},M.length?M:(0,O.tZ)(U.Menu.Item,{disabled:!0},"No actions")),trigger:["click"],onVisibleChange:e=>!e&&n()},(0,O.tZ)("span",{id:`hidden-span-${e}`,css:(0,O.iv)({visibility:"hidden",position:"fixed",top:x,left:S,width:1,height:1},"","")})),document.body)},ve=(0,u.forwardRef)(Ze),fe={annotationData:c().object,actions:c().object,chartId:c().number.isRequired,datasource:c().object,initialValues:c().object,formData:c().object.isRequired,latestQueryFormData:c().object,labelColors:c().object,sharedLabelColors:c().object,height:c().number,width:c().number,setControlValue:c().func,vizType:c().string.isRequired,triggerRender:c().bool,chartAlert:c().string,chartStatus:c().string,queriesResponse:c().arrayOf(c().object),triggerQuery:c().bool,chartIsStale:c().bool,addFilter:c().func,setDataMask:c().func,onFilterMenuOpen:c().func,onFilterMenuClose:c().func,ownState:c().object,postTransformProps:c().func,source:c().oneOf([n.Dashboard,n.Explore]),emitCrossFilters:c().bool},ye={},Ce=[R.cg.INTERACTIVE_CHART],Se={addFilter:()=>ye,onFilterMenuOpen:()=>ye,onFilterMenuClose:()=>ye,initialValues:ye,setControlValue(){},triggerRender:!1};class xe extends u.Component{constructor(e){super(e),this.state={showContextMenu:e.source===n.Dashboard&&((0,m.cr)(m.TT.DRILL_TO_DETAIL)||(0,m.cr)(m.TT.DASHBOARD_CROSS_FILTERS)),inContextMenu:!1,legendState:void 0},this.hasQueryResponseChange=!1,this.contextMenuRef=u.createRef(),this.handleAddFilter=this.handleAddFilter.bind(this),this.handleRenderSuccess=this.handleRenderSuccess.bind(this),this.handleRenderFailure=this.handleRenderFailure.bind(this),this.handleSetControlValue=this.handleSetControlValue.bind(this),this.handleOnContextMenu=this.handleOnContextMenu.bind(this),this.handleContextMenuSelected=this.handleContextMenuSelected.bind(this),this.handleContextMenuClosed=this.handleContextMenuClosed.bind(this),this.handleLegendStateChanged=this.handleLegendStateChanged.bind(this),this.onContextMenuFallback=this.onContextMenuFallback.bind(this),this.hooks={onAddFilter:this.handleAddFilter,onContextMenu:this.state.showContextMenu?this.handleOnContextMenu:void 0,onError:this.handleRenderFailure,setControlValue:this.handleSetControlValue,onFilterMenuOpen:this.props.onFilterMenuOpen,onFilterMenuClose:this.props.onFilterMenuClose,onLegendStateChanged:this.handleLegendStateChanged,setDataMask:e=>{var t;null==(t=this.props.actions)||t.updateDataMask(this.props.chartId,e)}},this.mutableQueriesResponse=I()(this.props.queriesResponse)}shouldComponentUpdate(e,t){var a,n;return!(!(e.queriesResponse&&["success","rendered"].indexOf(e.chartStatus)>-1)||null!=(a=e.queriesResponse)&&null!=(n=a[0])&&n.error)&&(!D()(this.state,t)||(this.hasQueryResponseChange=e.queriesResponse!==this.props.queriesResponse,this.hasQueryResponseChange&&(this.mutableQueriesResponse=I()(e.queriesResponse)),this.hasQueryResponseChange||!D()(e.datasource,this.props.datasource)||e.annotationData!==this.props.annotationData||e.ownState!==this.props.ownState||e.filterState!==this.props.filterState||e.height!==this.props.height||e.width!==this.props.width||e.triggerRender||e.labelColors!==this.props.labelColors||e.sharedLabelColors!==this.props.sharedLabelColors||e.formData.color_scheme!==this.props.formData.color_scheme||e.formData.stack!==this.props.formData.stack||e.cacheBusterProp!==this.props.cacheBusterProp||e.emitCrossFilters!==this.props.emitCrossFilters))}handleAddFilter(e,t,a=!0,n=!0){this.props.addFilter(e,t,a,n)}handleRenderSuccess(){const{actions:e,chartStatus:t,chartId:a,vizType:n}=this.props;["loading","rendered"].indexOf(t)<0&&e.chartRenderingSucceeded(a),this.hasQueryResponseChange&&e.logEvent(C.aD,{slice_id:a,viz_type:n,start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:C.Yd.getTimestamp()-this.renderStartTime})}handleRenderFailure(e,t){const{actions:a,chartId:n}=this.props;g.Z.warn(e),a.chartRenderingFailed(e.toString(),n,t?t.componentStack:null),this.hasQueryResponseChange&&a.logEvent(C.aD,{slice_id:n,has_err:!0,error_details:e.toString(),start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:C.Yd.getTimestamp()-this.renderStartTime})}handleSetControlValue(...e){const{setControlValue:t}=this.props;t&&t(...e)}handleOnContextMenu(e,t,a){this.contextMenuRef.current.open(e,t,a),this.setState({inContextMenu:!0})}handleContextMenuSelected(){this.setState({inContextMenu:!1})}handleContextMenuClosed(){this.setState({inContextMenu:!1})}handleLegendStateChanged(e){this.setState({legendState:e})}onContextMenuFallback(e){this.state.inContextMenu||(e.preventDefault(),this.handleOnContextMenu(e.clientX,e.clientY))}render(){var e;const{chartAlert:t,chartStatus:a,chartId:o,emitCrossFilters:r}=this.props;if("loading"===a||t||null===a)return null;this.renderStartTime=C.Yd.getTimestamp();const{width:l,height:i,datasource:d,annotationData:c,initialValues:p,ownState:m,filterState:g,chartIsStale:b,formData:Z,latestQueryFormData:v,postTransformProps:y}=this.props,S=b&&v?v:Z,x=S.viz_type||this.props.vizType,_=E()(x),M="table"===x?`superset-chart-${_}`:_;let T;const w=(0,h.t)("No results were returned for this query"),I=this.props.source===n.Explore?(0,h.t)("Make sure that the controls are configured properly and the datasource contains data for the selected time range"):void 0,k="chart.svg";T=l>300&&i>220?(0,O.tZ)(f.XJ,{title:w,description:I,image:k}):(0,O.tZ)(f.Tc,{title:w,image:k});const D=null!=(e=(0,$.Z)().get(Z.viz_type))&&e.behaviors.find((e=>e===R.cg.DRILL_TO_DETAIL))?{inContextMenu:this.state.inContextMenu}:{};return(0,O.tZ)(u.Fragment,null,this.state.showContextMenu&&(0,O.tZ)(ve,{ref:this.contextMenuRef,id:o,formData:S,onSelection:this.handleContextMenuSelected,onClose:this.handleContextMenuClosed}),(0,O.tZ)("div",{onContextMenu:this.state.showContextMenu?this.onContextMenuFallback:void 0},(0,O.tZ)(N.Z,(0,s.Z)({disableErrorBoundary:!0,key:`${o}`,id:`chart-id-${o}`,className:M,chartType:x,width:l,height:i,annotationData:c,datasource:d,initialValues:p,formData:S,ownState:m,filterState:g,hooks:this.hooks,behaviors:Ce,queriesData:this.mutableQueriesResponse,onRenderSuccess:this.handleRenderSuccess,onRenderFailure:this.handleRenderFailure,noResults:T,postTransformProps:y,emitCrossFilters:r,legendState:this.state.legendState},D))))}}xe.propTypes=fe,xe.defaultProps=Se;const _e=xe;var Me=a(67417),Te=a(72875);const we=({chartId:e,error:t,...a})=>{const{result:n}=(0,Me.hb)(e),o=t&&{...t,extra:{...t.extra,owners:n}};return(0,O.tZ)(Te.Z,(0,s.Z)({},a,{error:o}))};var Ie=a(75701);const ke={annotationData:c().object,actions:c().object,chartId:c().number.isRequired,datasource:c().object,dashboardId:c().number,initialValues:c().object,formData:c().object.isRequired,labelColors:c().object,sharedLabelColors:c().object,width:c().number,height:c().number,setControlValue:c().func,timeout:c().number,vizType:c().string.isRequired,triggerRender:c().bool,force:c().bool,isFiltersInitialized:c().bool,chartAlert:c().string,chartStatus:c().string,chartStackTrace:c().string,queriesResponse:c().arrayOf(c().object),triggerQuery:c().bool,chartIsStale:c().bool,errorMessage:c().node,addFilter:c().func,onQuery:c().func,onFilterMenuOpen:c().func,onFilterMenuClose:c().func,ownState:c().object,postTransformProps:c().func,datasetsStatus:c().oneOf(["loading","error","complete"]),isInView:c().bool,emitCrossFilters:c().bool},De={},Fe=(0,h.t)("The dataset associated with this chart no longer exists"),Ee={addFilter:()=>De,onFilterMenuOpen:()=>De,onFilterMenuClose:()=>De,initialValues:De,setControlValue(){},triggerRender:!1,dashboardId:null,chartStackTrace:null,force:!1,isInView:!0},Re=p.iK.div`
  min-height: ${e=>e.height}px;
  position: relative;

  .chart-tooltip {
    opacity: 0.75;
    font-size: ${({theme:e})=>e.typography.sizes.s}px;
  }

  .slice_container {
    display: flex;
    flex-direction: column;
    justify-content: center;

    height: ${e=>e.height}px;

    .pivot_table tbody tr {
      font-feature-settings: 'tnum' 1;
    }

    .alert {
      margin: ${({theme:e})=>2*e.gridUnit}px;
    }
  }
`,$e=p.iK.div`
  font-family: ${({theme:e})=>e.typography.families.monospace};
  word-break: break-word;
  overflow-x: auto;
  white-space: pre-wrap;
`;class Ne extends u.PureComponent{constructor(e){super(e),this.handleRenderContainerFailure=this.handleRenderContainerFailure.bind(this)}componentDidMount(){this.props.triggerQuery&&this.runQuery()}componentDidUpdate(){this.props.triggerQuery&&this.runQuery()}runQuery(){this.props.chartId>0&&(0,m.cr)(m.TT.CLIENT_CACHE)?this.props.actions.getSavedChart(this.props.formData,this.props.force||(0,x.eY)(S.KD.force),this.props.timeout,this.props.chartId,this.props.dashboardId,this.props.ownState):this.props.actions.postChartFormData(this.props.formData,Boolean(this.props.force||(0,x.eY)(S.KD.force)),this.props.timeout,this.props.chartId,this.props.dashboardId,this.props.ownState)}handleRenderContainerFailure(e,t){const{actions:a,chartId:n}=this.props;g.Z.warn(e),a.chartRenderingFailed(e.toString(),n,t?t.componentStack:null),a.logEvent(C.aD,{slice_id:n,has_err:!0,error_details:e.toString(),start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:C.Yd.getTimestamp()-this.renderStartTime})}renderErrorMessage(e){var t;const{chartId:a,chartAlert:o,chartStackTrace:r,datasource:l,dashboardId:i,height:s,datasetsStatus:d}=this.props,c=null==e||null==(t=e.errors)?void 0:t[0],u=o||(null==e?void 0:e.message);return void 0!==o&&o!==Fe&&l===Z.tw&&d!==T.ni.ERROR?(0,O.tZ)(Re,{key:a,"data-ui-anchor":"chart",className:"chart-container",height:s},(0,O.tZ)(v.Z,null)):(0,O.tZ)(we,{key:a,chartId:a,error:c,subtitle:(0,O.tZ)($e,null,u),copyText:u,link:e?e.link:null,source:i?n.Dashboard:n.Explore,stackTrace:r})}render(){const{height:e,chartAlert:t,chartStatus:a,errorMessage:n,chartIsStale:o,queriesResponse:r=[],width:l}=this.props,i="loading"===a;return this.renderContainerStartTime=C.Yd.getTimestamp(),"failed"===a?r.map((e=>this.renderErrorMessage(e))):n&&0===(0,b.Z)(r).length?(0,O.tZ)(f.XJ,{title:(0,h.t)("Add required control values to preview chart"),description:(0,Ie.J)(!0),image:"chart.svg"}):i||t||n||!o||0!==(0,b.Z)(r).length?(0,O.tZ)(y.Z,{onError:this.handleRenderContainerFailure,showMessage:!1},(0,O.tZ)(Re,{"data-ui-anchor":"chart",className:"chart-container",height:e,width:l},(0,O.tZ)("div",{className:"slice_container"},this.props.isInView||!(0,m.cr)(m.TT.DASHBOARD_VIRTUALIZATION)||(0,_.b)()?(0,O.tZ)(_e,(0,s.Z)({},this.props,{source:this.props.dashboardId?"dashboard":"explore"})):(0,O.tZ)(v.Z,null)),i&&(0,O.tZ)(v.Z,null))):(0,O.tZ)(f.XJ,{title:(0,h.t)("Your chart is ready to go!"),description:(0,O.tZ)("span",null,(0,h.t)('Click on "Create chart" button in the control panel on the left to preview a visualization or')," ",(0,O.tZ)("span",{role:"button",tabIndex:0,onClick:this.props.onQuery},(0,h.t)("click here")),"."),image:"chart.svg"})}}Ne.propTypes=ke,Ne.defaultProps=Ee;const Oe=Ne,Ae=(0,o.$j)(null,(function(e){return{actions:(0,r.DE)({...l,updateDataMask:q.eG,logEvent:i.logEvent},e)}}))(Oe)},96022:(e,t,a)=>{a.d(t,{ZN:()=>V,gT:()=>P});var n=a(73126),o=a(67294),r=a(28216),l=a(51995),i=a(70917),s=a(61988),d=a(93185),c=a(70707),u=a(83862),h=a(1304),p=a(35932),m=a(14114),g=a(12515),b=a(56727),Z=a(23525),v=a(10222),f=a(3003),y=a(97381),C=a(3741),S=a(15423),x=a(9875),_=a(13433),M=a(27600),T=a(50909);const w=(0,l.iK)(T.qi)`
  && {
    margin: 0 0 ${({theme:e})=>e.gridUnit}px;
  }
`,I=({formData:e,addDangerToast:t})=>{const[a,n]=(0,o.useState)("400"),[r,l]=(0,o.useState)("600"),[d,c]=(0,o.useState)(""),[u,h]=(0,o.useState)(""),p=(0,o.useCallback)((e=>{const{value:t,name:a}=e.currentTarget;"width"===a&&l(t),"height"===a&&n(t)}),[]),m=(0,o.useCallback)((()=>{c(""),(0,Z.YE)(e).then((e=>{c(e),h("")})).catch((()=>{h((0,s.t)("Error")),t((0,s.t)("Sorry, something went wrong. Try again later."))}))}),[t,e]);(0,o.useEffect)((()=>{m()}),[]);const g=(0,o.useMemo)((()=>{if(!d)return"";const e=`${d}?${M.KD.standalone.name}=1&height=${a}`;return`<iframe\n  width="${r}"\n  height="${a}"\n  seamless\n  frameBorder="0"\n  scrolling="no"\n  src="${e}"\n>\n</iframe>`}),[a,d,r]),b=u||g||(0,s.t)("Generating link, please wait..");return(0,i.tZ)("div",{id:"embed-code-popover"},(0,i.tZ)("div",{css:i.iv`
          display: flex;
          flex-direction: column;
        `},(0,i.tZ)(_.Z,{shouldShowText:!1,text:g,copyNode:(0,i.tZ)(w,{buttonSize:"xsmall"},(0,i.tZ)("i",{className:"fa fa-clipboard"}))}),(0,i.tZ)(x.Kx,{name:"embedCode",disabled:!g,value:b,rows:"4",readOnly:!0,css:e=>i.iv`
            resize: vertical;
            padding: ${2*e.gridUnit}px;
            font-size: ${e.typography.sizes.s}px;
            border-radius: 4px;
            background-color: ${e.colors.secondary.light5};
          `})),(0,i.tZ)("div",{css:e=>i.iv`
          display: flex;
          margin-top: ${4*e.gridUnit}px;
          & > div {
            margin-right: ${2*e.gridUnit}px;
          }
          & > div:last-of-type {
            margin-right: 0;
            margin-left: ${2*e.gridUnit}px;
          }
        `},(0,i.tZ)("div",null,(0,i.tZ)("label",{htmlFor:"embed-height"},(0,s.t)("Chart height")),(0,i.tZ)(x.II,{type:"text",defaultValue:a,name:"height",onChange:p})),(0,i.tZ)("div",null,(0,i.tZ)("label",{htmlFor:"embed-width"},(0,s.t)("Chart width")),(0,i.tZ)(x.II,{type:"text",defaultValue:r,name:"width",onChange:p,id:"embed-width"}))))};var k=a(73727);const D=({chartId:e,dashboards:t=[],...a})=>{const r=(0,l.Fg)(),[d,h]=(0,o.useState)(),[p,m]=(0,o.useState)(),g=t.length>10,b=t.filter((e=>!d||e.dashboard_title.toLowerCase().includes(d.toLowerCase()))),Z=0===t.length,v=d&&0===b.length,f=e?`?focused_chart=${e}`:"";return(0,i.tZ)(o.Fragment,null,g&&(0,i.tZ)(x.II,{allowClear:!0,placeholder:(0,s.t)("Search"),prefix:(0,i.tZ)(c.Z.Search,{iconSize:"l"}),css:i.iv`
            width: ${220}px;
            margin: ${2*r.gridUnit}px ${3*r.gridUnit}px;
          `,value:d,onChange:e=>h(e.currentTarget.value)}),(0,i.tZ)("div",{css:i.iv`
          max-height: ${300}px;
          overflow: auto;
        `},b.map((e=>(0,i.tZ)(u.Menu.Item,(0,n.Z)({key:String(e.id),onMouseEnter:()=>m(e.id),onMouseLeave:()=>{p===e.id&&m(null)}},a),(0,i.tZ)(k.rU,{target:"_blank",rel:"noreferer noopener",to:`/superset/dashboard/${e.id}${f}`},(0,i.tZ)("div",{css:i.iv`
                  display: flex;
                  flex-direction: row;
                  align-items: center;
                  max-width: ${220}px;
                `},(0,i.tZ)("div",{css:i.iv`
                    white-space: normal;
                  `},e.dashboard_title),(0,i.tZ)(c.Z.Full,{iconSize:"l",iconColor:r.colors.grayscale.base,css:i.iv`
                    margin-left: ${2*r.gridUnit}px;
                    visibility: ${p===e.id?"visible":"hidden"};
                  `})))))),v&&(0,i.tZ)("div",{css:i.iv`
              margin-left: ${3*r.gridUnit}px;
              margin-bottom: ${r.gridUnit}px;
            `},(0,s.t)("No results found")),Z&&(0,i.tZ)(u.Menu.Item,(0,n.Z)({disabled:!0,css:i.iv`
              min-width: ${220}px;
            `},a),(0,s.t)("None"))))},F="edit_properties",E="export_to_csv",R="export_to_csv_pivoted",$="export_to_json",N="export_to_xlsx",O="download_as_image",A="copy_permalink",L="embed_code",U="share_by_email",z="view_query",q="run_in_sql_lab",j=["pivot_table_v2"],V=l.iK.div`
  ${({theme:e})=>i.iv`
    display: flex;
    align-items: center;

    & svg {
      width: ${3*e.gridUnit}px;
      height: ${3*e.gridUnit}px;
    }

    & span[role='checkbox'] {
      display: inline-flex;
      margin-right: ${e.gridUnit}px;
    }
  `}
`,B=((0,l.iK)(p.Z)`
  ${({theme:e})=>i.iv`
    width: ${8*e.gridUnit}px;
    height: ${8*e.gridUnit}px;
    padding: 0;
    border: 1px solid ${e.colors.primary.dark2};

    &.ant-btn > span.anticon {
      line-height: 0;
      transition: inherit;
    }

    &:hover:not(:focus) > span.anticon {
      color: ${e.colors.primary.light1};
    }
  `}
`,i.iv`
  .ant-dropdown-menu-item > & > .anticon:first-child {
    margin-right: 0;
    vertical-align: 0;
  }
`),P=(e,t,a,p,x,_,M,...T)=>{const w=(0,l.Fg)(),{addDangerToast:k,addSuccessToast:V}=(0,m.e1)(),P=(0,r.I0)(),[H,Q]=(0,o.useState)(null),[Y,K]=(0,o.useState)(!1),G=(0,r.v9)((e=>{var t;return null==(t=e.charts)?void 0:t[(0,g.Jp)(e.explore)]})),{datasource:W}=e,X=(0,o.useCallback)((async()=>{try{const t=(0,s.t)("Superset Chart"),a=await(0,Z.YE)(e),n=encodeURIComponent((0,s.t)("%s%s","Check out this chart: ",a));window.location.href=`mailto:?Subject=${t}%20&Body=${n}`}catch(e){k((0,s.t)("Sorry, something went wrong. Try again later."))}}),[k,e]),J=(0,o.useCallback)((()=>t?(0,g.pe)({formData:e,ownState:_,resultType:"full",resultFormat:"csv"}):null),[t,e]),ee=(0,o.useCallback)((()=>t?(0,g.pe)({formData:e,resultType:"post_processed",resultFormat:"csv"}):null),[t,e]),te=(0,o.useCallback)((()=>(0,g.pe)({formData:e,resultType:"results",resultFormat:"json"})),[e]),ae=(0,o.useCallback)((()=>(0,g.pe)({formData:e,resultType:"results",resultFormat:"xlsx"})),[e]),ne=(0,o.useCallback)((async()=>{try{if(!e)throw new Error;await(0,v.Z)((()=>(0,Z.YE)(e))),V((0,s.t)("Copied to clipboard!"))}catch(e){k((0,s.t)("Sorry, something went wrong. Try again later."))}}),[k,V,e]),oe=(0,o.useCallback)((({key:t,domEvent:n})=>{var o;switch(t){case F:x(),K(!1);break;case E:J(),K(!1),P((0,y.logEvent)(C.F8,{chartId:null==a?void 0:a.slice_id,chartName:null==a?void 0:a.slice_name}));break;case R:ee(),K(!1),P((0,y.logEvent)(C.t4,{chartId:null==a?void 0:a.slice_id,chartName:null==a?void 0:a.slice_name}));break;case $:te(),K(!1),P((0,y.logEvent)(C.Tl,{chartId:null==a?void 0:a.slice_id,chartName:null==a?void 0:a.slice_name}));break;case N:ae(),K(!1),P((0,y.logEvent)(C.BL,{chartId:null==a?void 0:a.slice_id,chartName:null==a?void 0:a.slice_name}));break;case O:(0,b.Z)(".panel-body .chart-container",null!=(o=null==a?void 0:a.slice_name)?o:(0,s.t)("New chart"),!0)(n),K(!1),P((0,y.logEvent)(C.xE,{chartId:null==a?void 0:a.slice_id,chartName:null==a?void 0:a.slice_name}));break;case A:ne(),K(!1);break;case L:K(!1);break;case U:X(),K(!1);break;case z:K(!1);break;case q:p(e,n.metaKey),K(!1)}}),[ne,J,ee,te,e,p,x,X,null==a?void 0:a.slice_name]);return[(0,o.useMemo)((()=>(0,i.tZ)(u.Menu,(0,n.Z)({onClick:oe,selectable:!1},T),(0,i.tZ)(o.Fragment,null,a&&(0,i.tZ)(u.Menu.Item,{key:F},(0,s.t)("Edit chart properties")),(0,i.tZ)(u.Menu.SubMenu,{title:(0,s.t)("Dashboards added to"),key:"dashboards_added_to"},(0,i.tZ)(D,{chartId:null==a?void 0:a.slice_id,dashboards:M})),(0,i.tZ)(u.Menu.Divider,null)),(0,i.tZ)(u.Menu.SubMenu,{title:(0,s.t)("Download"),key:"download_submenu"},j.includes(e.viz_type)?(0,i.tZ)(o.Fragment,null,(0,i.tZ)(u.Menu.Item,{key:E,icon:(0,i.tZ)(c.Z.FileOutlined,{css:B}),disabled:!t},(0,s.t)("Export to original .CSV")),(0,i.tZ)(u.Menu.Item,{key:R,icon:(0,i.tZ)(c.Z.FileOutlined,{css:B}),disabled:!t},(0,s.t)("Export to pivoted .CSV"))):(0,i.tZ)(u.Menu.Item,{key:E,icon:(0,i.tZ)(c.Z.FileOutlined,{css:B}),disabled:!t},(0,s.t)("Export to .CSV")),(0,i.tZ)(u.Menu.Item,{key:$,icon:(0,i.tZ)(c.Z.FileOutlined,{css:B})},(0,s.t)("Export to .JSON")),(0,i.tZ)(u.Menu.Item,{key:O,icon:(0,i.tZ)(c.Z.FileImageOutlined,{css:B})},(0,s.t)("Download as image")),(0,i.tZ)(u.Menu.Item,{key:N,icon:(0,i.tZ)(c.Z.FileOutlined,{css:B})},(0,s.t)("Export to Excel"))),(0,i.tZ)(u.Menu.SubMenu,{title:(0,s.t)("Share"),key:"share_submenu"},(0,i.tZ)(u.Menu.Item,{key:A},(0,s.t)("Copy permalink to clipboard")),(0,i.tZ)(u.Menu.Item,{key:U},(0,s.t)("Share chart by email")),(0,d.cr)(d.TT.EMBEDDABLE_CHARTS)?(0,i.tZ)(u.Menu.Item,{key:L},(0,i.tZ)(h.Z,{triggerNode:(0,i.tZ)("span",null,(0,s.t)("Embed code")),modalTitle:(0,s.t)("Embed code"),modalBody:(0,i.tZ)(I,{formData:e,addDangerToast:k}),maxWidth:100*w.gridUnit+"px",destroyOnClose:!0,responsive:!0})):null),(0,i.tZ)(u.Menu.Divider,null),H?(0,i.tZ)(o.Fragment,null,(0,i.tZ)(u.Menu.SubMenu,{title:(0,s.t)("Manage email report")},(0,i.tZ)(f.Z,{chart:G,setShowReportSubMenu:Q,showReportSubMenu:H,setIsDropdownVisible:K,isDropdownVisible:Y,useTextMenu:!0})),(0,i.tZ)(u.Menu.Divider,null)):(0,i.tZ)(u.Menu,null,(0,i.tZ)(f.Z,{chart:G,setShowReportSubMenu:Q,setIsDropdownVisible:K,isDropdownVisible:Y,useTextMenu:!0})),(0,i.tZ)(u.Menu.Item,{key:z},(0,i.tZ)(h.Z,{triggerNode:(0,i.tZ)("span",null,(0,s.t)("View query")),modalTitle:(0,s.t)("View query"),modalBody:(0,i.tZ)(S.Z,{latestQueryFormData:e}),draggable:!0,resizable:!0,responsive:!0})),W&&(0,i.tZ)(u.Menu.Item,{key:q},(0,s.t)("Run in SQL Lab")))),[k,t,G,M,oe,Y,e,H,a,w.gridUnit]),Y,K]}},15856:(e,t,a)=>{a.d(t,{j:()=>l}),a(67294);var n=a(70917),o=a(70707),r=a(58593);const l=({title:e,color:t})=>(0,n.tZ)(r.u,{title:e,placement:"top"},(0,n.tZ)(o.Z.InfoCircleOutlined,{css:e=>n.iv`
        color: ${t||e.colors.text.label};
        margin-left: ${2*e.gridUnit}px;
        &.anticon {
          font-size: unset;
          .anticon {
            line-height: unset;
            vertical-align: unset;
          }
        }
      `}))},41814:(e,t,a)=>{a.d(t,{p:()=>le});var n=a(73126),o=a(41609),r=a.n(o),l=a(67294),i=a(61988),s=a(70917),d=a(32103),c=a(51995),u=a(11064),h=a(16355),p=a(69363),m=a(83862),g=a(16550),b=a(74069),Z=a(35932),v=a(28216),f=a(57001),y=a(88889),C=a(55786),S=a(99612),x=a(38703),_=a(27600);const M=function({value:e}){return(0,s.tZ)("span",null,e?_.Ly:_.gz)},T=function(){return(0,s.tZ)("span",{css:e=>s.iv`
        color: ${e.colors.grayscale.light1};
      `},_.Wq)};var w=a(42846),I=a(51115);const k=function({format:e=w.default.DATABASE_DATETIME,value:t}){return t?(0,s.tZ)("span",null,(0,I.bt)(e).format(t)):(0,s.tZ)(T,null)};var D=a(94301),F=a(52256),E=a(93197),R=a(87183),$=a(4715),N=a(70707),O=a(99299);const A=function(e){const{headerTitle:t,groupTitle:a,groupOptions:n,value:o,onChange:r}=e,i=(0,c.Fg)(),[d,u]=(0,l.useState)(!1);return(0,s.tZ)("div",{css:s.iv`
        display: flex;
        align-items: center;
      `},(0,s.tZ)(O.Z,{trigger:"click",visible:d,content:(0,s.tZ)("div",null,(0,s.tZ)("div",{css:s.iv`
                font-weight: ${i.typography.weights.bold};
                margin-bottom: ${i.gridUnit}px;
              `},a),(0,s.tZ)(R.Y.Group,{value:o,onChange:e=>{r(e.target.value),u(!1)}},(0,s.tZ)($.T,{direction:"vertical"},n.map((e=>(0,s.tZ)(R.Y,{key:e.value,value:e.value},e.label)))))),placement:"bottomLeft",arrowPointAtCenter:!0},(0,s.tZ)(N.Z.SettingOutlined,{iconSize:"m",iconColor:i.colors.grayscale.light1,css:s.iv`
            margin-top: 3px; // we need exactly 3px to align the icon
            margin-right: ${i.gridUnit}px;
          `,onClick:()=>u(!0)})),t)};var L=a(42190),U=a(53579),z=a(60331),q=a(72813),j=a(89555);function V({filters:e,setFilters:t,totalCount:a,loading:n,onReload:o}){const r=(0,c.Fg)(),d=(0,l.useMemo)((()=>Object.assign({},...e.map((e=>({[(0,q.GA)(e.col)?e.col.label:e.col]:e}))))),[e]),u=(0,l.useCallback)((e=>{const a={...d};delete a[e],t([...Object.values(a)])}),[d,t]),h=(0,l.useMemo)((()=>Object.entries(d).map((([e,{val:t,formattedVal:a}])=>({colName:e,val:null!=a?a:t}))).sort(((e,t)=>e.colName.localeCompare(t.colName)))),[d]);return(0,s.tZ)("div",{css:s.iv`
        display: flex;
        justify-content: space-between;
        padding: ${r.gridUnit/2}px 0;
        margin-bottom: ${2*r.gridUnit}px;
      `},(0,s.tZ)("div",{css:s.iv`
          display: flex;
          flex-wrap: wrap;
          margin-bottom: -${4*r.gridUnit}px;
        `},h.map((({colName:e,val:t})=>(0,s.tZ)(z.Z,{closable:!0,onClose:u.bind(null,e),key:e,css:s.iv`
              height: ${6*r.gridUnit}px;
              display: flex;
              align-items: center;
              padding: ${r.gridUnit/2}px ${2*r.gridUnit}px;
              margin-right: ${4*r.gridUnit}px;
              margin-bottom: ${4*r.gridUnit}px;
              line-height: 1.2;
            `},(0,s.tZ)("span",{css:s.iv`
                margin-right: ${r.gridUnit}px;
              `},e),(0,s.tZ)("strong",null,t))))),(0,s.tZ)("div",{css:s.iv`
          display: flex;
          align-items: center;
          height: min-content;
        `},(0,s.tZ)(j.Z,{loading:n&&!a,rowcount:a}),(0,s.tZ)(N.Z.ReloadOutlined,{iconColor:r.colors.grayscale.light1,iconSize:"l","aria-label":(0,i.t)("Reload"),role:"button",onClick:o})))}var B=a(57557),P=a.n(B),H=a(65946);const Q=50;var Y,K={name:"82a6rk",styles:"flex:1"};function G({children:e}){const{ref:t,height:a}=(0,S.NB)();return(0,s.tZ)("div",{ref:t,css:K},l.cloneElement(e,{height:a}))}function W({formData:e,initialFilters:t}){const a=(0,c.Fg)(),[n,o]=(0,l.useState)(0),r=(0,l.useRef)(n),[d,u]=(0,l.useState)(t),[h,p]=(0,l.useState)(!1),[m,g]=(0,l.useState)(""),[b,Z]=(0,l.useState)(new Map),[f,S]=(0,l.useState)({}),_=(0,v.v9)((e=>e.common.conf.SAMPLES_ROW_LIMIT)),[w,I]=(0,l.useMemo)((()=>e.datasource.split("__")),[e.datasource]),{metadataBar:R,status:$}=(0,U.S)({datasetId:w}),N=(0,l.useMemo)((()=>{const e=b.get(n);return e?(r.current=n,e):b.get(r.current)}),[n,b]),O=(0,l.useMemo)((()=>(null==N?void 0:N.colNames.map(((e,t)=>({key:e,dataIndex:e,title:(null==N?void 0:N.colTypes[t])===y.Z.TEMPORAL?(0,s.tZ)(A,{headerTitle:e,groupTitle:(0,i.t)("Formatting"),groupOptions:[{label:(0,i.t)("Original value"),value:Y.Original},{label:(0,i.t)("Formatted value"),value:Y.Formatted}],value:f[e]===Y.Original?Y.Original:Y.Formatted,onChange:t=>S((a=>({...a,[e]:t})))}):e,render:a=>!0===a||!1===a?(0,s.tZ)(M,{value:a}):null===a?(0,s.tZ)(T,null):(null==N?void 0:N.colTypes[t])===y.Z.TEMPORAL&&f[e]!==Y.Original&&("number"==typeof a||a instanceof Date)?(0,s.tZ)(k,{value:a}):String(a),width:150}))))||[]),[null==N?void 0:N.colNames,null==N?void 0:N.colTypes,f]),z=(0,l.useMemo)((()=>(null==N?void 0:N.data.map(((e,t)=>null==N?void 0:N.colNames.reduce(((t,a)=>({...t,[a]:e[a]})),{key:t}))))||[]),[null==N?void 0:N.colNames,null==N?void 0:N.data]),q=(0,l.useCallback)((()=>{g(""),Z(new Map),o(0)}),[]);(0,l.useEffect)((()=>{g(""),Z(new Map),o(0)}),[d]),(0,l.useEffect)((()=>{if(b.has(n)&&[...b.keys()].at(-1)!==n){const e=new Map(b);e.delete(n),Z(e.set(n,b.get(n)))}}),[n,b]),(0,l.useEffect)((()=>{if(!m&&!h&&!b.has(n)){var t;p(!0);const a=null!=(t=function(e,t){if(!e)return;const a=(0,H.Z)(e),n=P()(a.extras,"having"),o=[...(0,C.Z)(a.filters),...(0,C.Z)(t).map((e=>P()(e,"formattedVal")))];return{granularity:a.granularity,time_range:a.time_range,filters:o,extras:n}}(e,d))?t:{},o=Math.ceil(_/Q);(0,F.getDatasourceSamples)(I,w,!1,a,Q,n+1).then((e=>{Z(new Map([...[...b.entries()].slice(1-o),[n,{total:e.total_count,data:e.data,colNames:(0,C.Z)(e.colnames),colTypes:(0,C.Z)(e.coltypes)}]])),g("")})).catch((e=>{g(`${e.name}: ${e.message}`)})).finally((()=>{p(!1)}))}}),[_,w,I,d,e,h,n,m,b]);const j=!m&&!b.size||$===L.ni.LOADING;let B=null;if(m)B=(0,s.tZ)("pre",{css:s.iv`
          margin-top: ${4*a.gridUnit}px;
        `},m);else if(j)B=(0,s.tZ)(x.Z,null);else if(0===(null==N?void 0:N.total)){const e=(0,i.t)("No rows were returned for this dataset");B=(0,s.tZ)(D.x3,{image:"document.svg",title:e})}else B=(0,s.tZ)(G,null,(0,s.tZ)(E.ZP,{data:z,columns:O,size:E.ex.SMALL,defaultPageSize:Q,recordCount:null==N?void 0:N.total,usePagination:!0,loading:h,onChange:e=>o(e.current?e.current-1:0),resizable:!0,virtualize:!0,allowHTML:!0}));return(0,s.tZ)(l.Fragment,null,!j&&R,!j&&(0,s.tZ)(V,{filters:d,setFilters:u,totalCount:null==N?void 0:N.total,loading:h,onReload:q}),B)}!function(e){e[e.Original=0]="Original",e[e.Formatted=1]="Formatted"}(Y||(Y={}));const X=({exploreChart:e,closeModal:t})=>(0,s.tZ)(l.Fragment,null,(0,s.tZ)(Z.Z,{buttonStyle:"secondary",buttonSize:"small",onClick:e},(0,i.t)("Edit chart")),(0,s.tZ)(Z.Z,{buttonStyle:"primary",buttonSize:"small",onClick:t},(0,i.t)("Close")));function J({chartId:e,formData:t,initialFilters:a,showModal:n,onHideModal:o}){const r=(0,c.Fg)(),d=(0,g.k6)(),u=(0,l.useContext)(f.DashboardPageIdContext),{slice_name:h}=(0,v.v9)((t=>t.sliceEntities.slices[e])),p=(0,l.useMemo)((()=>`/explore/?dashboard_page_id=${u}&slice_id=${e}`),[e,u]),m=(0,l.useCallback)((()=>{d.push(p)}),[p,d]);return(0,s.tZ)(b.default,{show:n,onHide:null!=o?o:()=>null,css:s.iv`
        .ant-modal-body {
          display: flex;
          flex-direction: column;
        }
      `,title:(0,i.t)("Drill to detail: %s",h),footer:(0,s.tZ)(X,{exploreChart:m}),responsive:!0,resizable:!0,resizableConfig:{minHeight:128*r.gridUnit,minWidth:128*r.gridUnit,defaultSize:{width:"auto",height:"75vh"}},draggable:!0,destroyOnClose:!0,maskClosable:!1},(0,s.tZ)(W,{formData:t,initialFilters:a}))}var ee=a(69175),te=a(15856),ae=a(46219);const ne=(0,i.t)("Drill to detail by"),oe=({children:e,...t})=>(0,s.tZ)(m.Menu.Item,(0,n.Z)({disabled:!0},t),(0,s.tZ)("div",{css:s.iv`
        white-space: normal;
        max-width: 160px;
      `},e)),re=(0,c.iK)((({children:e,stripHTML:t=!1})=>{const a=t&&"string"==typeof e?(0,d.ZU)(e):e;return(0,s.tZ)("span",null,a)}))`
  ${({theme:e})=>`\n     font-weight: ${e.typography.weights.bold};\n     color: ${e.colors.primary.base};\n   `}
`,le=({chartId:e,formData:t,filters:a=[],isContextMenu:o=!1,contextMenuY:d=0,onSelection:c=(()=>null),onClick:g=(()=>null),submenuIndex:b=0,...Z})=>{const[v,f]=(0,l.useState)([]),[y,C]=(0,l.useState)(!1),S=(0,l.useCallback)(((e,t)=>{g(t),c(),f(e),C(!0)}),[g,c]),x=(0,l.useCallback)((()=>{C(!1)}),[]),_=(0,l.useMemo)((()=>{var e;return null==(e=(0,u.Z)().get(t.viz_type))?void 0:e.behaviors.find((e=>e===h.cg.DRILL_TO_DETAIL))}),[t.viz_type]),M=(0,l.useMemo)((()=>{const{metrics:e}=(0,p.Z)(t);return r()(e)}),[t]);let T,w;T=_&&M?(0,s.tZ)(oe,(0,n.Z)({},Z,{key:"drill-detail-no-aggregations"}),(0,i.t)("Drill to detail"),(0,s.tZ)(te.j,{title:(0,i.t)("Drill to detail is disabled because this chart does not group data by dimension value.")})):(0,s.tZ)(m.Menu.Item,(0,n.Z)({},Z,{key:"drill-detail-no-filters",onClick:S.bind(null,[])}),(0,i.t)("Drill to detail")),_||(w=(0,s.tZ)(oe,(0,n.Z)({},Z,{key:"drill-detail-by-chart-not-supported"}),ne,(0,s.tZ)(te.j,{title:(0,i.t)("Drill to detail by value is not yet supported for this chart type.")}))),_&&M&&(w=(0,s.tZ)(oe,(0,n.Z)({},Z,{key:"drill-detail-by-no-aggregations"}),ne));const I=(0,l.useMemo)((()=>(0,ee.th)(d,a.length>1?a.length+1:a.length,b)),[d,a.length,b]);return _&&!M&&null!=a&&a.length&&(w=(0,s.tZ)(m.Menu.SubMenu,(0,n.Z)({},Z,{popupOffset:[0,I],popupClassName:"chart-context-submenu",title:ne}),(0,s.tZ)("div",null,a.map(((e,t)=>(0,s.tZ)(ae.i,(0,n.Z)({},Z,{tooltipText:`${ne} ${e.formattedVal}`,key:`drill-detail-filter-${t}`,onClick:S.bind(null,[e])}),`${ne} `,(0,s.tZ)(re,{stripHTML:!0},e.formattedVal)))),a.length>1&&(0,s.tZ)(m.Menu.Item,(0,n.Z)({},Z,{key:"drill-detail-filter-all",onClick:S.bind(null,a)}),(0,s.tZ)("div",null,`${ne} `,(0,s.tZ)(re,{stripHTML:!1},(0,i.t)("all"))))))),!_||M||null!=a&&a.length||(w=(0,s.tZ)(oe,(0,n.Z)({},Z,{key:"drill-detail-by-select-aggregation"}),ne,(0,s.tZ)(te.j,{title:(0,i.t)("Right-click on a dimension value to drill to detail by that value.")}))),(0,s.tZ)(l.Fragment,null,T,o&&w,(0,s.tZ)(J,{chartId:e,formData:t,initialFilters:v,showModal:y,onHideModal:x}))}},46219:(e,t,a)=>{a.d(t,{i:()=>s});var n=a(73126),o=(a(67294),a(3297)),r=a(70917),l=a(83862),i=a(58593);const s=({tooltipText:e,children:t,...a})=>{const[s,d]=(0,o.Z)();return(0,r.tZ)(l.Menu.Item,(0,n.Z)({css:r.iv`
        display: flex;
      `},a),(0,r.tZ)(i.u,{title:d?e:null},(0,r.tZ)("div",{ref:s,css:r.iv`
            max-width: 100%;
            ${o.B};
          `},t)))}},69175:(e,t,a)=>{a.d(t,{$t:()=>n,th:()=>o});const n=(e,t,a=Number.MAX_SAFE_INTEGER,n=0)=>{const o=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),r=Math.min(32*t,a)+32+n;return o-e<r?o-r:e},o=(e,t,a=0,o=Number.MAX_SAFE_INTEGER,r=0)=>{const l=e+4+32*a+4;return n(l,t,o,r)-l}},88694:(e,t,a)=>{a.d(t,{$i:()=>h,Lt:()=>u});var n=a(73126),o=(a(67294),a(4715)),r=a(51995),l=a(70707),i=a(70917);const s=r.iK.div`
  width: ${({theme:e})=>.75*e.gridUnit}px;
  height: ${({theme:e})=>.75*e.gridUnit}px;
  border-radius: 50%;
  background-color: ${({theme:e})=>e.colors.grayscale.light1};

  font-weight: ${({theme:e})=>e.typography.weights.normal};
  display: inline-flex;
  position: relative;

  &:hover {
    background-color: ${({theme:e})=>e.colors.primary.base};

    &::before,
    &::after {
      background-color: ${({theme:e})=>e.colors.primary.base};
    }
  }

  &::before,
  &::after {
    position: absolute;
    content: ' ';
    width: ${({theme:e})=>.75*e.gridUnit}px;
    height: ${({theme:e})=>.75*e.gridUnit}px;
    border-radius: 50%;
    background-color: ${({theme:e})=>e.colors.grayscale.light1};
  }

  &::before {
    top: ${({theme:e})=>e.gridUnit}px;
  }

  &::after {
    bottom: ${({theme:e})=>e.gridUnit}px;
  }
`,d=r.iK.div`
  display: flex;
  align-items: center;
  padding: ${({theme:e})=>2*e.gridUnit}px;
  padding-left: ${({theme:e})=>e.gridUnit}px;
`;var c;!function(e){e.VERTICAL="vertical",e.HORIZONTAL="horizontal"}(c||(c={}));const u=({overlay:e,iconOrientation:t=c.VERTICAL,...a})=>(0,i.tZ)(o.Gj,(0,n.Z)({overlay:e},a),(0,i.tZ)(d,null,((e=c.VERTICAL)=>e===c.HORIZONTAL?(0,i.tZ)(l.Z.MoreHoriz,{iconSize:"xl"}):(0,i.tZ)(s,null))(t))),h=e=>(0,i.tZ)(o.Gj,(0,n.Z)({overlayStyle:{zIndex:99,animationDuration:"0s"}},e))},91914:(e,t,a)=>{a.d(t,{Z:()=>d});var n=a(1510),o=a(99543);function r(e){return Object.entries(e).map((([e,t])=>({col:e,op:Array.isArray(t)?"IN":"==",val:t}))).filter((e=>null!==e.val))}var l=a(87915);const i={},s={};function d({chart:e,filters:t,nativeFilters:a,chartConfiguration:d,colorScheme:c,colorNamespace:u,sliceId:h,dataMask:p,extraControls:m,labelColors:g,sharedLabelColors:b,allSliceIds:Z}){const v=s[h];if(i[h]===t&&(0,o.JB)(null==v?void 0:v.color_scheme,c,{ignoreUndefined:!0})&&(0,o.JB)(null==v?void 0:v.color_namespace,u,{ignoreUndefined:!0})&&(0,o.JB)(null==v?void 0:v.label_colors,g,{ignoreUndefined:!0})&&(0,o.JB)(null==v?void 0:v.shared_label_colors,b,{ignoreUndefined:!0})&&v&&(0,o.JB)(null==v?void 0:v.dataMask,p,{ignoreUndefined:!0})&&(0,o.JB)(null==v?void 0:v.extraControls,m,{ignoreUndefined:!0}))return v;let f={};const y=(0,l.g)({chartConfiguration:d,dataMask:p,nativeFilters:a,allSliceIds:Z}),C=Object.entries(y).filter((([,{scope:t}])=>t.includes(e.id))).map((([e])=>e));C.length&&(f={extra_form_data:(0,n.vk)(p,C)});const S={...e.form_data,label_colors:g,shared_label_colors:b,...c&&{color_scheme:c},extra_filters:r(t),...f,...m};return i[h]=t,s[h]={...S,dataMask:p,extraControls:m},S}},66124:(e,t,a)=>{a.d(t,{X:()=>h,c:()=>p});var n=a(4788),o=a.n(n),r=a(67294),l=a(51995),i=a(88889),s=a(70917),d=a(50909),c=a(54076),u=a(61587);const h=l.iK.div`
  ${({theme:e})=>`\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: ${2*e.gridUnit}px;\n\n    span {\n      flex-shrink: 0;\n    }\n  `}
`,p=({data:e,datasourceId:t,onInputChange:a,columnNames:n,columnTypes:l,isLoading:p})=>{const m=(0,u.W)(t),g=o()(n,l).filter((([e,t])=>t===i.Z.TEMPORAL&&e&&!m.includes(e))).map((([e])=>e)),b=(0,r.useMemo)((()=>(0,c.cD)(e,g)),[e,g]);return(0,s.tZ)(h,null,(0,s.tZ)(d.HS,{onChangeHandler:a}),(0,s.tZ)("div",{css:s.iv`
          display: flex;
          align-items: center;
        `},(0,s.tZ)(d.uy,{data:e,loading:p}),(0,s.tZ)(d.m,{data:b,columns:n})))}},5462:(e,t,a)=>{a.d(t,{T:()=>d});var n=a(67294),o=a(61988),r=a(76962),l=a(50909),i=a(66124),s=a(70917);const d=({data:e,colnames:t,coltypes:a,datasourceId:d,dataSize:c=50,isVisible:u})=>{const[h,p]=(0,n.useState)(""),m=(0,l._q)(t,a,e,d,u,{},!0),g=(0,l.C4)(h,e);return(0,s.tZ)(n.Fragment,null,(0,s.tZ)(i.c,{data:g,columnNames:t,columnTypes:a,datasourceId:d,onInputChange:e=>p(e),isLoading:!1}),(0,s.tZ)(r.Z,{columns:m,data:g,pageSize:c,noDataText:(0,o.t)("No results"),emptyWrapperType:r.u.Small,className:"table-condensed",isPaginationSticky:!0,showRowCount:!1,small:!0}))}},21496:(e,t,a)=>{a.d(t,{c9:()=>F,Tg:()=>_});var n,o=a(67294),r=a(51995),l=a(93185),i=a(61988),s=a(70707),d=a(71262),c=a(61337);!function(e){e.Results="results",e.Samples="samples"}(n||(n={}));var u=a(11064),h=a(55786),p=a(38703),m=a(94301),g=a(52256),b=a(98286),Z=a(5462),v=a(66124),f=a(70917);const y=r.iK.pre`
  margin-top: ${({theme:e})=>4*e.gridUnit+"px"};
`,C=new WeakMap,S=({isRequest:e,queryFormData:t,queryForce:a,ownState:n,errorMessage:r,actions:l,isVisible:s,dataSize:d=50})=>{var c;const S=(0,u.Z)().get((null==t?void 0:t.viz_type)||(null==t?void 0:t.vizType)),[x,_]=(0,o.useState)([]),[M,T]=(0,o.useState)(!0),[w,I]=(0,o.useState)(""),k=null!=(c=null==S?void 0:S.queryObjectCount)?c:1;if((0,o.useEffect)((()=>{r||(e&&C.has(t)&&(_((0,h.Z)(C.get(t))),I(""),a&&l&&l.setForceQuery(!1),T(!1)),e&&!C.has(t)&&(T(!0),(0,g.getChartDataRequest)({formData:t,force:a,resultFormat:"json",resultType:"results",ownState:n}).then((({json:e})=>{_((0,h.Z)(e.result)),I(""),C.set(t,e.result),a&&l&&l.setForceQuery(!1)})).catch((e=>{(0,b.O$)(e).then((({error:e,message:t})=>{I(e||t||(0,i.t)("Sorry, an error occurred"))}))})).finally((()=>{T(!1)}))))}),[t,e]),(0,o.useEffect)((()=>{r&&T(!1)}),[r]),M)return Array(k).fill((0,f.tZ)(p.Z,null));if(r){const e=(0,i.t)("Run a query to display results");return Array(k).fill((0,f.tZ)(m.x3,{image:"document.svg",title:e}))}if(w){const e=(0,f.tZ)(o.Fragment,null,(0,f.tZ)(v.c,{data:[],columnNames:[],columnTypes:[],datasourceId:t.datasource,onInputChange:()=>{},isLoading:!1}),(0,f.tZ)(y,null,w));return Array(k).fill(e)}if(0===x.length){const e=(0,i.t)("No results were returned for this query");return Array(k).fill((0,f.tZ)(m.x3,{image:"document.svg",title:e}))}return x.slice(0,k).map(((e,a)=>(0,f.tZ)(Z.T,{data:e.data,colnames:e.colnames,coltypes:e.coltypes,dataSize:d,datasourceId:t.datasource,key:a,isVisible:s})))},x=r.iK.div`
  display: flex;
  flex-direction: column;
  height: 100%;

  .ant-tabs {
    height: 100%;
  }

  .ant-tabs-content {
    height: 100%;
  }

  .ant-tabs-tabpane {
    display: flex;
    flex-direction: column;
  }

  .table-condensed {
    overflow: auto;
  }
`,_=({isRequest:e,queryFormData:t,queryForce:a,ownState:o,errorMessage:r,actions:l,isVisible:s,dataSize:c=50})=>{const u=S({errorMessage:r,queryFormData:t,queryForce:a,ownState:o,isRequest:e,actions:l,dataSize:c,isVisible:s});if(1===u.length)return(0,f.tZ)(x,null,u[0]);const h=u.map(((e,t)=>0===t?(0,f.tZ)(d.ZP.TabPane,{tab:(0,i.t)("Results"),key:n.Results},e):(0,f.tZ)(d.ZP.TabPane,{tab:(0,i.t)("Results %s",t+1),key:`${n.Results} ${t+1}`},e)));return(0,f.tZ)(x,null,(0,f.tZ)(d.ZP,{fullWidth:!1},h))};var M=a(76962),T=a(50909);const w=r.iK.pre`
  margin-top: ${({theme:e})=>4*e.gridUnit+"px"};
`,I=new WeakSet,k=({isRequest:e,datasource:t,queryForce:a,actions:n,dataSize:r=50,isVisible:l})=>{const[s,d]=(0,o.useState)(""),[c,u]=(0,o.useState)([]),[b,Z]=(0,o.useState)([]),[y,C]=(0,o.useState)([]),[S,x]=(0,o.useState)(!1),[_,k]=(0,o.useState)(""),D=(0,o.useMemo)((()=>`${t.id}__${t.type}`),[t]);(0,o.useEffect)((()=>{e&&a&&I.delete(t),e&&!I.has(t)&&(x(!0),(0,g.getDatasourceSamples)(t.type,t.id,a,{}).then((e=>{u((0,h.Z)(e.data)),Z((0,h.Z)(e.colnames)),C((0,h.Z)(e.coltypes)),k(""),I.add(t),a&&n&&n.setForceQuery(!1)})).catch((e=>{u([]),Z([]),C([]),k(`${e.name}: ${e.message}`)})).finally((()=>{x(!1)})))}),[t,e,a]);const F=(0,T._q)(b,y,c,D,l,{},!0),E=(0,T.C4)(s,c);if(S)return(0,f.tZ)(p.Z,null);if(_)return(0,f.tZ)(o.Fragment,null,(0,f.tZ)(v.c,{data:E,columnNames:b,columnTypes:y,datasourceId:D,onInputChange:e=>d(e),isLoading:S}),(0,f.tZ)(w,null,_));if(0===c.length){const e=(0,i.t)("No samples were returned for this dataset");return(0,f.tZ)(m.x3,{image:"document.svg",title:e})}return(0,f.tZ)(o.Fragment,null,(0,f.tZ)(v.c,{data:E,columnNames:b,columnTypes:y,datasourceId:D,onInputChange:e=>d(e),isLoading:S}),(0,f.tZ)(M.Z,{columns:F,data:E,pageSize:r,noDataText:(0,i.t)("No results"),emptyWrapperType:M.u.Small,className:"table-condensed",isPaginationSticky:!0,showRowCount:!1,small:!0}))},D=r.iK.div`
  ${({theme:e})=>`\n    position: relative;\n    background-color: ${e.colors.grayscale.light5};\n    z-index: 5;\n    overflow: hidden;\n\n    .ant-tabs {\n      height: 100%;\n    }\n\n    .ant-tabs-content-holder {\n      height: 100%;\n    }\n\n    .ant-tabs-content {\n      height: 100%;\n    }\n\n    .ant-tabs-tabpane {\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n\n      .table-condensed {\n        height: 100%;\n        overflow: auto;\n        margin-bottom: ${4*e.gridUnit}px;\n\n        .table {\n          margin-bottom: ${2*e.gridUnit}px;\n        }\n      }\n\n      .pagination-container > ul[role='navigation'] {\n        margin-top: 0;\n      }\n    }\n  `}
`,F=({queryFormData:e,datasource:t,queryForce:a,onCollapseChange:u,chartStatus:h,ownState:p,errorMessage:m,actions:g})=>{const b=(0,r.Fg)(),[Z,y]=(0,o.useState)(n.Results),[C,x]=(0,o.useState)({results:!1,samples:!1}),[_,M]=(0,o.useState)(!(0,l.cr)(l.TT.DATAPANEL_CLOSED_BY_DEFAULT)&&(0,c.rV)(c.dR.is_datapanel_open,!1));(0,o.useEffect)((()=>{(0,l.cr)(l.TT.DATAPANEL_CLOSED_BY_DEFAULT)||(0,c.LS)(c.dR.is_datapanel_open,_)}),[_]),(0,o.useEffect)((()=>{_||x({results:!1,samples:!1}),_&&Z.startsWith(n.Results)&&"rendered"===h&&x({results:!0,samples:!1}),_&&Z===n.Samples&&x({results:!1,samples:!0})}),[_,Z,h]);const T=(0,o.useCallback)((e=>{u(e),M(e)}),[u]),w=(0,o.useCallback)(((e,t)=>{_?e===Z&&(t.preventDefault(),T(!1)):T(!0),y(e)}),[Z,T,_]),I=(0,o.useMemo)((()=>{const e=_?(0,f.tZ)(s.Z.CaretUp,{iconColor:b.colors.grayscale.base,"aria-label":(0,i.t)("Collapse data panel")}):(0,f.tZ)(s.Z.CaretDown,{iconColor:b.colors.grayscale.base,"aria-label":(0,i.t)("Expand data panel")});return(0,f.tZ)(v.X,null,_?(0,f.tZ)("span",{role:"button",tabIndex:0,onClick:()=>T(!1)},e):(0,f.tZ)("span",{role:"button",tabIndex:0,onClick:()=>T(!0)},e))}),[T,_,b.colors.grayscale.base]),F=S({errorMessage:m,queryFormData:e,queryForce:a,ownState:p,isRequest:C.results,actions:g,isVisible:n.Results===Z}).map(((e,t)=>0===t?(0,f.tZ)(d.ZP.TabPane,{tab:(0,i.t)("Results"),key:n.Results},e):t>0?(0,f.tZ)(d.ZP.TabPane,{tab:(0,i.t)("Results %s",t+1),key:`${n.Results} ${t+1}`},e):null));return(0,f.tZ)(D,null,(0,f.tZ)(d.ZP,{fullWidth:!1,tabBarExtraContent:I,activeKey:_?Z:"",onTabClick:w},F,(0,f.tZ)(d.ZP.TabPane,{tab:(0,i.t)("Samples"),key:n.Samples},(0,f.tZ)(k,{datasource:t,queryForce:a,isRequest:C.samples,actions:g,isVisible:n.Samples===Z}))))}},15423:(e,t,a)=>{a.d(t,{Z:()=>p});var n=a(67294),o=a(51995),r=a(55786),l=a(61988),i=a(38703),s=a(98286),d=a(52256),c=a(85626),u=a(70917);const h=o.iK.div`
  height: 100%;
  display: flex;
  flex-direction: column;
`,p=e=>{const[t,a]=(0,n.useState)([]),[o,p]=(0,n.useState)(!1),[m,g]=(0,n.useState)(null);return(0,n.useEffect)((()=>{p(!0),(0,d.getChartDataRequest)({formData:e.latestQueryFormData,resultFormat:"json",resultType:"query"}).then((({json:e})=>{a((0,r.Z)(e.result)),p(!1),g(null)})).catch((e=>{(0,s.O$)(e).then((({error:t,message:a})=>{g(t||a||e.statusText||(0,l.t)("Sorry, An error occurred")),p(!1)}))}))}),[JSON.stringify(e.latestQueryFormData)]),o?(0,u.tZ)(i.Z,null):m?(0,u.tZ)("pre",null,m):(0,u.tZ)(h,null,t.map((e=>e.query?(0,u.tZ)(c.Z,{sql:e.query,language:e.language||void 0}):null)))}},53579:(e,t,a)=>{a.d(t,{S:()=>h});var n=a(67294),o=a(51995),r=a(61988),l=a(70917),i=a(29487),s=a(67697),d=a(32871),c=a(42190),u=a(6412);const h=({dataset:e,datasetId:t})=>{const a=(0,o.Fg)(),[h,p]=(0,n.useState)(),[m,g]=(0,n.useState)(e?c.ni.COMPLETE:c.ni.LOADING);return(0,n.useEffect)((()=>{!e&&t&&(0,u.e)({endpoint:`/api/v1/dataset/${t}`}).then((({json:{result:e}})=>{p(e),g(c.ni.COMPLETE)})).catch((()=>{g(c.ni.ERROR)}))}),[t,e]),{metadataBar:(0,n.useMemo)((()=>{const t=[],n=e||h;if(n){var o,u;const{changed_on_humanized:e,created_on_humanized:a,description:l,table_name:i,changed_by:s,created_by:c,owners:h}=n,p=(0,r.t)("Not available"),m=`${null!=(o=null==c?void 0:c.first_name)?o:""} ${null!=(u=null==c?void 0:c.last_name)?u:""}`.trim()||p,g=s?`${s.first_name} ${s.last_name}`:p,b=(null==h?void 0:h.length)>0?h.map((e=>`${e.first_name} ${e.last_name}`)):[p];t.push({type:d.p.TABLE,title:i}),t.push({type:d.p.LAST_MODIFIED,value:e,modifiedBy:g}),t.push({type:d.p.OWNER,createdBy:m,owners:b,createdOn:a}),l&&t.push({type:d.p.DESCRIPTION,value:l})}return(0,l.tZ)("div",{css:l.iv`
          display: flex;
          margin-bottom: ${4*a.gridUnit}px;
        `},m===c.ni.COMPLETE&&(0,l.tZ)(s.ZP,{items:t,tooltipPlacement:"bottom"}),m===c.ni.ERROR&&(0,l.tZ)(i.Z,{type:"error",message:(0,r.t)("There was an error loading the dataset metadata")}))}),[e,h,m,a.gridUnit]),status:m}}},3003:(e,t,a)=>{a.d(t,{x:()=>B,Z:()=>Y});var n,o,r=a(70917),l=a(73126),i=a(41609),s=a.n(i),d=a(67294),c=a(28216),u=a(75049),h=a(51995),p=a(93185),m=a(85716),g=a(61988),b=a(70707),Z=a(12441),v=a(83862),f=a(87253),y=a(54076),C=a(88694),S=a(17198),x=a(98286),_=a(39666),M=a(29487),T=a(98978),w=a(12353),I=a(9875),k=a(14114);!function(e){e.DASHBOARDS="dashboards",e.CHARTS="charts"}(n||(n={})),function(e){e.TEXT="TEXT",e.PNG="PNG",e.CSV="CSV"}(o||(o={}));var D=a(34858),F=a(20095),E=a(62948);const R=["pivot_table_v2","table","paired_ttest"],$={crontab:"0 12 * * 1"},N={},O=(0,k.ZP)((function({onHide:e,show:t=!1,dashboardId:a,chart:n,userId:l,userEmail:i,creationMethod:s,dashboardName:u,chartName:h}){var p;const m=null==n||null==(p=n.sliceFormData)?void 0:p.viz_type,Z=!!n,v=Z&&m&&R.includes(m),f=v?o.TEXT:o.PNG,y=u||h,C=(0,d.useMemo)((()=>({...$,name:y?(0,g.t)("Weekly Report for %s",y):(0,g.t)("Weekly Report")})),[y]),S=(0,d.useCallback)(((e,t)=>"reset"===t?C:{...e,...t}),[C]),[k,O]=(0,d.useReducer)(S,C),[A,L]=(0,d.useState)(),U=(0,c.I0)(),z=(0,c.v9)((e=>{const t=a?B.DASHBOARDS:B.CHARTS;return(0,D._l)(e,t,a||(null==n?void 0:n.id))||N})),q=z&&Object.keys(z).length;(0,d.useEffect)((()=>{O(q?z:"reset")}),[q,z]);const j=(0,r.tZ)(E.Mv,null,(0,r.tZ)(b.Z.Calendar,null),(0,r.tZ)("span",{className:"text"},q?(0,g.t)("Edit email report"):(0,g.t)("Schedule a new email report"))),V=(0,r.tZ)(d.Fragment,null,(0,r.tZ)(E.OD,{key:"back",onClick:e},(0,g.t)("Cancel")),(0,r.tZ)(E.OD,{key:"submit",buttonStyle:"primary",onClick:async()=>{const t={type:"Report",active:!0,force_screenshot:!1,custom_width:k.custom_width,creation_method:s,dashboard:a,chart:null==n?void 0:n.id,owners:[l],recipients:[{recipient_config_json:{target:i},type:"Email"}],name:k.name,description:k.description,crontab:k.crontab,report_format:k.report_format||f,timezone:k.timezone};O({isSubmitting:!0,error:void 0});try{q?await U((0,_.Me)(k.id,t)):await U((0,_.cq)(t)),e()}catch(e){const{error:t}=await(0,x.O$)(e);O({error:t})}O({isSubmitting:!1})},disabled:!k.name,loading:k.isSubmitting},q?(0,g.t)("Save"):(0,g.t)("Add"))),P=(0,r.tZ)(d.Fragment,null,(0,r.tZ)(E.aQ,null,(0,r.tZ)("h4",null,(0,g.t)("Message content"))),(0,r.tZ)("div",{className:"inline-container"},(0,r.tZ)(E.E5,{onChange:e=>{O({report_format:e.target.value})},value:k.report_format||f},v&&(0,r.tZ)(E.Ks,{value:o.TEXT},(0,g.t)("Text embedded in email")),(0,r.tZ)(E.Ks,{value:o.PNG},(0,g.t)("Image (PNG) embedded in email")),(0,r.tZ)(E.Ks,{value:o.CSV},(0,g.t)("Formatted CSV attached in email"))))),H=(0,r.tZ)(F.j5,null,(0,r.tZ)("div",{className:"control-label",css:E.yk},F.KL.CUSTOM_SCREENSHOT_WIDTH_TEXT),(0,r.tZ)("div",{className:"input-container"},(0,r.tZ)(I.II,{type:"number",name:"custom_width",value:(null==k?void 0:k.custom_width)||"",placeholder:F.KL.CUSTOM_SCREENSHOT_WIDTH_PLACEHOLDER_TEXT,onChange:e=>{O({custom_width:parseInt(e.target.value,10)||null})}})));return(0,r.tZ)(E.oA,{show:t,onHide:e,title:j,footer:V,width:"432",centered:!0},(0,r.tZ)(E.zV,null,(0,r.tZ)(w.Z,{id:"name",name:"name",value:k.name||"",placeholder:C.name,required:!0,validationMethods:{onChange:({target:e})=>O({name:e.value})},label:(0,g.t)("Report Name")}),(0,r.tZ)(w.Z,{id:"description",name:"description",value:(null==k?void 0:k.description)||"",validationMethods:{onChange:({target:e})=>{O({description:e.value})}},label:(0,g.t)("Description"),placeholder:(0,g.t)("Include a description that will be sent with your report"),css:E.gt})),(0,r.tZ)(E.nn,null,(0,r.tZ)(E.oo,null,(0,r.tZ)("h4",{css:e=>(0,E.kq)(e)},(0,g.t)("Schedule")),(0,r.tZ)("p",null,(0,g.t)("A screenshot of the dashboard will be sent to your email at"))),(0,r.tZ)(E.xZ,{clearButton:!1,value:k.crontab||"0 12 * * 1",setValue:e=>{O({crontab:e})},onError:L}),(0,r.tZ)(E.G,null,A),(0,r.tZ)("div",{className:"control-label",css:e=>(0,E.Su)(e)},(0,g.t)("Timezone")),(0,r.tZ)(T.Z,{timezone:k.timezone,onTimezoneChange:e=>{O({timezone:e})}}),Z&&P,(!Z||!v)&&H),k.error&&(0,r.tZ)(M.Z,{type:"error",css:e=>(0,E.gH)(e),message:q?(0,g.t)("Failed to update report"):(0,g.t)("Failed to create report"),description:k.error}))}));var A=a(96022);const L=(0,u.I)(),U=e=>r.iv`
  color: ${e.colors.error.base};
`,z=e=>r.iv`
  & .ant-menu-item {
    padding: 5px 12px;
    margin-top: 0px;
    margin-bottom: 4px;
    :hover {
      color: ${e.colors.grayscale.dark1};
    }
  }
  :hover {
    background-color: ${e.colors.secondary.light5};
  }
`,q=e=>r.iv`
  &:hover {
    color: ${e.colors.grayscale.dark1};
    background-color: ${e.colors.secondary.light5};
  }
`,j=h.iK.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  > *:first-child {
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }
`,V=L.get("report-modal.dropdown.item.icon");var B;!function(e){e.CHARTS="charts",e.DASHBOARDS="dashboards"}(B||(B={}));const P={};var H={name:"1e1ncky",styles:"border:none"},Q={name:"833hqy",styles:"width:200px"};function Y({dashboardId:e,chart:t,useTextMenu:a=!1,setShowReportSubMenu:n,setIsDropdownVisible:o,isDropdownVisible:i,...u}){const x=(0,c.I0)(),M=(0,c.v9)((a=>{const n=e?B.DASHBOARDS:B.CHARTS;return(0,D._l)(a,n,e||(null==t?void 0:t.id))||P})),T=(null==M?void 0:M.active)||!1,w=(0,c.v9)((e=>e.user)),I=()=>!!(0,p.cr)(p.TT.ALERT_REPORTS)&&(!(null==w||!w.userId)&&(!!(e||null!=t&&t.id)&&Object.keys(w.roles||[]).map((e=>w.roles[e].filter((e=>"menu_access"===e[0]&&"Manage"===e[1])))).some((e=>e.length>0)))),[k,F]=(0,d.useState)(null),E=(0,h.Fg)(),R=(0,m.D)(e),[$,N]=(0,d.useState)(!1),L=async(e,t)=>{null!=e&&e.id&&x((0,_.M)(e,t))},Y=I()&&!!(e&&R!==e||null!=t&&t.id);(0,d.useEffect)((()=>{Y&&x((0,_.Aw)({userId:w.userId,filterField:e?"dashboard_id":"chart_id",creationMethod:e?"dashboards":"charts",resourceId:e||(null==t?void 0:t.id)}))}),[]);const K=M&&n&&I();(0,d.useEffect)((()=>{K?n(!0):!M&&n&&n(!1)}),[M]);const G=()=>{o&&(o(!1),N(!0))};return(0,r.tZ)(d.Fragment,null,I()&&(0,r.tZ)(d.Fragment,null,(0,r.tZ)(O,{userId:w.userId,show:$,onHide:()=>N(!1),userEmail:w.email,dashboardId:e,chart:t,creationMethod:e?B.DASHBOARDS:B.CHARTS}),a?s()(M)?(0,r.tZ)(v.Menu,(0,l.Z)({selectable:!1},u,{css:z}),(0,r.tZ)(v.Menu.Item,{onClick:G},V?(0,r.tZ)(j,null,(0,r.tZ)("div",null,(0,g.t)("Set up an email report")),(0,r.tZ)(V,null)):(0,g.t)("Set up an email report")),(0,r.tZ)(v.Menu.Divider,null)):i&&(0,r.tZ)(v.Menu,{selectable:!1,css:H},(0,r.tZ)(v.Menu.Item,{css:q,onClick:()=>L(M,!T)},(0,r.tZ)(A.ZN,null,(0,r.tZ)(f.ZP,{checked:T,onChange:y.EI}),(0,g.t)("Email reports active"))),(0,r.tZ)(v.Menu.Item,{css:q,onClick:G},(0,g.t)("Edit email report")),(0,r.tZ)(v.Menu.Item,{css:q,onClick:()=>{o&&(o(!1),F(M))}},(0,g.t)("Delete email report"))):s()(M)?(0,r.tZ)("span",{role:"button",title:(0,g.t)("Schedule email report"),tabIndex:0,className:"action-button action-schedule-report",onClick:()=>N(!0)},(0,r.tZ)(b.Z.Calendar,null)):(0,r.tZ)(d.Fragment,null,(0,r.tZ)(C.$i,{overlay:(0,r.tZ)(v.Menu,{selectable:!1,css:Q},(0,r.tZ)(v.Menu.Item,null,(0,g.t)("Email reports active"),(0,r.tZ)(Z.r,{checked:T,onClick:e=>L(M,e),size:"small",css:(0,r.iv)({marginLeft:2*E.gridUnit},"","")})),(0,r.tZ)(v.Menu.Item,{onClick:()=>N(!0)},(0,g.t)("Edit email report")),(0,r.tZ)(v.Menu.Item,{onClick:()=>F(M),css:U},(0,g.t)("Delete email report"))),trigger:["click"],getPopupContainer:e=>e.closest(".action-button")},(0,r.tZ)("span",{role:"button",className:"action-button action-schedule-report",tabIndex:0},(0,r.tZ)(b.Z.Calendar,null)))),k&&(0,r.tZ)(S.Z,{description:(0,g.t)("This action will permanently delete %s.",null==k?void 0:k.name),onConfirm:()=>{k&&(async e=>{await x((0,_.MZ)(e)),F(null)})(k)},onHide:()=>F(null),open:!0,title:(0,g.t)("Delete Report?")})))}},6954:(e,t,a)=>{a.d(t,{z:()=>i});var n=a(67294),o=a(14670),r=a.n(o);const l=new(a(47337).g0)("tab_id_channel");function i(){const[e,t]=(0,n.useState)();return(0,n.useEffect)((()=>{if(!function(){try{return window.localStorage&&window.sessionStorage}catch(e){return!1}}())return void(e||t(r().generate()));const a=()=>{let e;try{e=window.localStorage.getItem("last_tab_id")}catch(e){}const a=String(e?Number.parseInt(e,10)+1:1);try{window.sessionStorage.setItem("tab_id",a),window.localStorage.setItem("last_tab_id",a)}catch(e){}t(a)};let n;try{n=window.sessionStorage.getItem("tab_id")}catch(e){}n?(l.postMessage({type:"REQUESTING_TAB_ID",tabId:n}),t(n)):a(),l.onmessage=t=>{if(t.tabId===e)if("REQUESTING_TAB_ID"===t.type){const e={type:"TAB_ID_DENIED",tabId:t.tabId};l.postMessage(e)}else"TAB_ID_DENIED"===t.type&&a()}}),[e]),e}},6412:(e,t,a)=>{a.d(t,{e:()=>l,f:()=>r});var n=a(31069),o=a(65108);const r=new Map,l=(0,o.g)(n.Z.get,r,(({endpoint:e})=>e||""))},56727:(e,t,a)=>{a.d(t,{Z:()=>u});var n=a(46926),o=a.n(n),r=a(21804),l=a.n(r),i=a(61988),s=a(51995),d=a(72570);const c=(e,t=new Date)=>`${l()(e)}-${t.toISOString().replace(/[: ]/g,"-")}`;function u(e,t,a=!1){return n=>{const r=a?document.querySelector(e):n.currentTarget.closest(e);return r?o().toJpeg(r,{quality:1,bgcolor:s.K6.colors.grayscale.light4,filter:e=>"string"!=typeof e.className||"mapboxgl-control-container"!==e.className&&!e.className.includes("ant-dropdown")}).then((e=>{const a=document.createElement("a");a.download=`${c(t)}.jpg`,a.href=e,a.click()})).catch((e=>{console.error("Creating image failed",e)})):(0,d.Dz)((0,i.t)("Image download failed, please refresh and try again."))}}},75701:(e,t,a)=>{a.d(t,{J:()=>l});var n=a(61988);const o=(0,n.t)("Create chart"),r=(0,n.t)("Update chart"),l=e=>(0,n.t)("Select values in highlighted field(s) in the control panel. Then run the query by clicking on the %s button.",`"${e?o:r}"`)},99232:(e,t,a)=>{a.d(t,{f:()=>i});var n=a(72813),o=a(61641),r=a(69856),l=a(56565);const i=(e,t=o.P.WHERE)=>{let a;var i;return a=(0,n.GA)(e.col)?{expressionType:"SQL",clause:t,sqlExpression:(0,l.c)({expressionType:o.v.SIMPLE,subject:`(${e.col.sqlExpression})`,operator:e.op,comparator:"val"in e?e.val:void 0})}:{expressionType:"SIMPLE",clause:t,operator:e.op,operatorId:null==(i=Object.entries(r.LT).find((t=>t[1].operation===e.op)))?void 0:i[0],subject:e.col,comparator:"val"in e?e.val:void 0},e.isExtra&&Object.assign(a,{isExtra:!0,filterOptionName:`filter_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}),a}}}]);
//# sourceMappingURL=490dad054cb0773aae89.chunk.js.map