"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[4502],{54070:(e,a,t)=>{t.d(a,{w:()=>d}),t(67294);var l=t(58593),n=t(83379),o=t(61988),s=t(70917);const d=({user:e,date:a})=>{const t=(0,s.tZ)("span",{className:"no-wrap"},a);if(e){const a=(0,n.Z)(e),d=(0,o.t)("Modified by: %s",a);return(0,s.tZ)(l.u,{title:d,placement:"bottom"},t)}return t}},95731:(e,a,t)=>{t.r(a),t.d(a,{default:()=>z});var l=t(75049),n=t(51995),o=t(61988),s=t(31069),d=t(93185),i=t(67294),r=t(15926),c=t.n(r),u=t(28216),b=t(35755),p=t(61337),h=t(38703),m=t(34858),_=t(40768),Z=t(14114),f=t(86074),g=t(17198),v=t(23525),w=t(27600),y=t(58593),S=t(70707),C=t(22318),E=t(93139),D=t(32228),x=t(19235),N=t(54070),k=t(12),A=t(70917);const L=(0,l.I)(),T=L.get("database.delete.related"),H=L.get("databaseconnection.extraOption"),O=(0,n.iK)(S.Z.Check)`
  color: ${({theme:e})=>e.colors.grayscale.dark1};
`,q=(0,n.iK)(S.Z.CancelX)`
  color: ${({theme:e})=>e.colors.grayscale.light1};
`,U=n.iK.div`
  color: ${({theme:e})=>e.colors.grayscale.base};

  .action-button {
    display: inline-block;
    height: 100%;
  }
`;function $({value:e}){return e?(0,A.tZ)(O,null):(0,A.tZ)(q,null)}const z=(0,Z.ZP)((function({addDangerToast:e,addSuccessToast:a,user:t}){const{state:{loading:l,resourceCount:n,resourceCollection:r},hasPerm:Z,fetchData:L,refreshData:O}=(0,m.Yi)("database",(0,o.t)("database"),e),q=(0,u.v9)((e=>e.user)),z=(0,v.eY)(w.KD.showDatabaseModal),[I,M]=(0,b.Kx)({databaseAdded:b.dJ}),[X,V]=(0,i.useState)(z||!1),[K,Q]=(0,i.useState)(null),[j,P]=(0,i.useState)(null),[R,Y]=(0,i.useState)(!1),B=(0,C.i5)(q),F=R||B,[J,W]=(0,i.useState)(!1),{roles:G}=q,{CSV_EXTENSIONS:ee,COLUMNAR_EXTENSIONS:ae,EXCEL_EXTENSIONS:te,ALLOWED_EXTENSIONS:le}=(0,u.v9)((e=>e.common.conf));function ne({database:e=null,modalOpen:a=!1}={}){P(e),V(a)}(0,i.useEffect)((()=>{null!=I&&I.databaseAdded&&(M({databaseAdded:void 0}),O())}),[I,M,O]);const oe=Z("can_write"),se=Z("can_write"),de=Z("can_write"),ie=Z("can_export")&&(0,d.cr)(d.TT.VERSIONED_EXPORT),{canUploadCSV:re,canUploadColumnar:ce,canUploadExcel:ue}=(0,_.Mc)(G,ee,ae,te,le),be=B&&!R,pe=[{label:(0,o.t)("Upload file to database"),childs:[{label:(0,o.t)("Upload CSV"),name:"Upload CSV file",url:"/csvtodatabaseview/form",perm:re&&F,disable:be},{label:(0,o.t)("Upload columnar file"),name:"Upload columnar file",url:"/columnartodatabaseview/form",perm:ce&&F,disable:be},{label:(0,o.t)("Upload Excel file"),name:"Upload Excel file",url:"/exceltodatabaseview/form",perm:ue&&F,disable:be}]}];(0,i.useEffect)((()=>{s.Z.get({endpoint:`/api/v1/database/?q=${c().encode({filters:[{col:"allow_file_upload",opr:"upload_is_enabled",value:!0}]})}`}).then((({json:e})=>{var a;const t=(null==e||null==(a=e.result)?void 0:a.filter((e=>{var a;return null==e||null==(a=e.engine_information)?void 0:a.supports_file_upload})))||[];Y((null==t?void 0:t.length)>=1)}))}),[X]);const he={activeChild:"Databases",dropDownLinks:pe.reduce(((e,a)=>(a.childs=a.childs.filter((e=>e.perm)),a.childs.length?(e.push(a),e):e)),[]),name:(0,o.t)("Databases")};oe&&(he.buttons=[{"data-test":"btn-create-database",name:(0,A.tZ)(i.Fragment,null,(0,A.tZ)("i",{className:"fa fa-plus"})," ",(0,o.t)("Database")," "),buttonStyle:"primary",onClick:()=>{ne({modalOpen:!0})}}]);const me=(0,i.useMemo)((()=>[{accessor:"database_name",Header:(0,o.t)("Name")},{accessor:"backend",Header:(0,o.t)("Backend"),size:"lg",disableSortBy:!0},{accessor:"allow_run_async",Header:(0,A.tZ)(y.u,{id:"allow-run-async-header-tooltip",title:(0,o.t)("Asynchronous query execution"),placement:"top"},(0,A.tZ)("span",null,(0,o.t)("AQE"))),Cell:({row:{original:{allow_run_async:e}}})=>(0,A.tZ)($,{value:e}),size:"sm"},{accessor:"allow_dml",Header:(0,A.tZ)(y.u,{id:"allow-dml-header-tooltip",title:(0,o.t)("Allow data manipulation language"),placement:"top"},(0,A.tZ)("span",null,(0,o.t)("DML"))),Cell:({row:{original:{allow_dml:e}}})=>(0,A.tZ)($,{value:e}),size:"sm"},{accessor:"allow_file_upload",Header:(0,o.t)("CSV upload"),Cell:({row:{original:{allow_file_upload:e}}})=>(0,A.tZ)($,{value:e}),size:"md"},{accessor:"expose_in_sqllab",Header:(0,o.t)("Expose in SQL Lab"),Cell:({row:{original:{expose_in_sqllab:e}}})=>(0,A.tZ)($,{value:e}),size:"md"},{Cell:({row:{original:{changed_by:e,changed_on_delta_humanized:a}}})=>(0,A.tZ)(N.w,{date:a,user:e}),Header:(0,o.t)("Last modified"),accessor:"changed_on_delta_humanized",size:"xl"},{Cell:({row:{original:e}})=>se||de||ie?(0,A.tZ)(U,{className:"actions"},de&&(0,A.tZ)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>{return a=e,s.Z.get({endpoint:`/api/v1/database/${a.id}/related_objects/`}).then((({json:e={}})=>{Q({...a,chart_count:e.charts.count,dashboard_count:e.dashboards.count,sqllab_tab_count:e.sqllab_tab_states.count})})).catch((0,_.v$)((e=>(0,o.t)("An error occurred while fetching database related data: %s",e))));var a}},(0,A.tZ)(y.u,{id:"delete-action-tooltip",title:(0,o.t)("Delete database"),placement:"bottom"},(0,A.tZ)(S.Z.Trash,null))),ie&&(0,A.tZ)(y.u,{id:"export-action-tooltip",title:(0,o.t)("Export"),placement:"bottom"},(0,A.tZ)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>{var a;void 0!==(a=e).id&&((0,D.Z)("database",[a.id],(()=>{W(!1)})),W(!0))}},(0,A.tZ)(S.Z.Share,null))),se&&(0,A.tZ)(y.u,{id:"edit-action-tooltip",title:(0,o.t)("Edit"),placement:"bottom"},(0,A.tZ)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>ne({database:e,modalOpen:!0})},(0,A.tZ)(S.Z.EditAlt,null)))):null,Header:(0,o.t)("Actions"),id:"actions",hidden:!se&&!de,disableSortBy:!0},{accessor:k.J.changed_by,hidden:!0}]),[de,se,ie]),_e=(0,i.useMemo)((()=>[{Header:(0,o.t)("Name"),key:"search",id:"database_name",input:"search",operator:E.p.contains},{Header:(0,o.t)("Expose in SQL Lab"),key:"expose_in_sql_lab",id:"expose_in_sqllab",input:"select",operator:E.p.equals,unfilteredLabel:(0,o.t)("All"),selects:[{label:(0,o.t)("Yes"),value:!0},{label:(0,o.t)("No"),value:!1}]},{Header:(0,A.tZ)(y.u,{id:"allow-run-async-filter-header-tooltip",title:(0,o.t)("Asynchronous query execution"),placement:"top"},(0,A.tZ)("span",null,(0,o.t)("AQE"))),key:"allow_run_async",id:"allow_run_async",input:"select",operator:E.p.equals,unfilteredLabel:(0,o.t)("All"),selects:[{label:(0,o.t)("Yes"),value:!0},{label:(0,o.t)("No"),value:!1}]},{Header:(0,o.t)("Modified by"),key:"changed_by",id:"changed_by",input:"select",operator:E.p.relationOneMany,unfilteredLabel:(0,o.t)("All"),fetchSelects:(0,_.tm)("database","changed_by",(0,_.v$)((e=>(0,o.t)("An error occurred while fetching dataset datasource values: %s",e))),t),paginate:!0}]),[]);return(0,A.tZ)(i.Fragment,null,(0,A.tZ)(f.Z,he),(0,A.tZ)(x.ZP,{databaseId:null==j?void 0:j.id,show:X,onHide:ne,onDatabaseAdd:()=>{O()}}),K&&(0,A.tZ)(g.Z,{description:(0,A.tZ)(i.Fragment,null,(0,A.tZ)("p",null,(0,o.t)("The database %s is linked to %s charts that appear on %s dashboards and users have %s SQL Lab tabs using this database open. Are you sure you want to continue? Deleting the database will break those objects.",K.database_name,K.chart_count,K.dashboard_count,K.sqllab_tab_count)),T&&(0,A.tZ)(T,{database:K})),onConfirm:()=>{K&&function(t){const{id:l,database_name:n}=t;s.Z.delete({endpoint:`/api/v1/database/${l}`}).then((()=>{O(),a((0,o.t)("Deleted: %s",n)),null!=H&&H.onDelete&&H.onDelete(t),(0,p.LS)(p.dR.db,null),Q(null)}),(0,_.v$)((a=>e((0,o.t)("There was an issue deleting %s: %s",n,a)))))}(K)},onHide:()=>Q(null),open:!0,title:(0,o.t)("Delete Database?")}),(0,A.tZ)(E.Z,{className:"database-list-view",columns:me,count:n,data:r,fetchData:L,filters:_e,initialSort:[{id:"changed_on_delta_humanized",desc:!0}],loading:l,addDangerToast:e,addSuccessToast:a,refreshData:()=>{},pageSize:25}),J&&(0,A.tZ)(h.Z,null))}))},83379:(e,a,t)=>{function l(e){return e?`${e.first_name} ${e.last_name}`:""}t.d(a,{Z:()=>l})}}]);
//# sourceMappingURL=02986c8b12058ef46d7c.chunk.js.map