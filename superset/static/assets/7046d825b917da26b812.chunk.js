"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[2527],{89033:(t,e,o)=>{o.d(e,{Z:()=>l});var n=o(4942),i=o(36750),r=o(49331),s=o(84287),a=o(39450);function u(t,e){const o={};for(const n in t)e.includes(n)||(o[n]=t[n]);return o}class l extends i.Z{constructor(...t){super(...t),(0,n.Z)(this,"state",void 0)}initializeAggregationLayer(t){super.initializeState(this.context),this.setState({ignoreProps:u(this.constructor._propTypes,t.data.props),dimensions:t})}updateState(t){super.updateState(t);const{changeFlags:e}=t;if(e.extensionsChanged){const t=this.getShaders({});t&&t.defines&&(t.defines.NON_INSTANCED_MODEL=1),this.updateShaders(t)}this._updateAttributes()}updateAttributes(t){this.setState({changedAttributes:t})}getAttributes(){return this.getAttributeManager().getShaderAttributes()}getModuleSettings(){const{viewport:t,mousePosition:e,gl:o}=this.context;return Object.assign(Object.create(this.props),{viewport:t,mousePosition:e,pickingActive:0,devicePixelRatio:(0,a.w)(o)})}updateShaders(t){}isAggregationDirty(t,e={}){const{props:o,oldProps:n,changeFlags:i}=t,{compareAll:s=!1,dimension:a}=e,{ignoreProps:u}=this.state,{props:l,accessors:c=[]}=a,{updateTriggersChanged:d}=i;if(i.dataChanged)return!0;if(d){if(d.all)return!0;for(const t of c)if(d[t])return!0}if(s)return!!i.extensionsChanged||(0,r.tg)({oldProps:n,newProps:o,ignoreProps:u,propTypes:this.constructor._propTypes});for(const t of l)if(o[t]!==n[t])return!0;return!1}isAttributeChanged(t){const{changedAttributes:e}=this.state;return t?e&&void 0!==e[t]:!function(t){let e=!0;for(const o in t){e=!1;break}return e}(e)}_getAttributeManager(){return new s.Z(this.context.gl,{id:this.props.id,stats:this.context.stats})}}(0,n.Z)(l,"layerName","AggregationLayer")},79543:(t,e,o)=>{o.d(e,{K:()=>n,P:()=>i});const n=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function i(t,e=!1,o=Float32Array){let n;if(Number.isFinite(t[0]))n=new o(t);else{n=new o(4*t.length);let e=0;for(let o=0;o<t.length;o++){const i=t[o];n[e++]=i[0],n[e++]=i[1],n[e++]=i[2],n[e++]=Number.isFinite(i[3])?i[3]:255}}if(e)for(let t=0;t<n.length;t++)n[t]/=255;return n}},36750:(t,e,o)=>{o.d(e,{Z:()=>u});var n=o(4942),i=o(5259),r=o(11482),s=o(77552),a=o(33230);class u extends i.Z{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every((t=>t.isLoaded))}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){const{object:e}=t;return e&&e.__source&&e.__source.parent&&e.__source.parent.id===this.id?(t.object=e.__source.object,t.index=e.__source.index,t):t}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){return e&&e.length}getSubLayerClass(t,e){const{_subLayerProps:o}=this.props;return o&&o[t]&&o[t].type||e}getSubLayerRow(t,e,o){return t.__source={parent:this,object:e,index:o},t}getSubLayerAccessor(t){if("function"==typeof t){const e={index:-1,data:this.props.data,target:[]};return(o,n)=>o&&o.__source?(e.index=o.__source.index,t(o.__source.object,e)):t(o,n)}return t}getSubLayerProps(t={}){var e;const{opacity:o,pickable:n,visible:i,parameters:r,getPolygonOffset:s,highlightedObjectIndex:u,autoHighlight:l,highlightColor:c,coordinateSystem:d,coordinateOrigin:p,wrapLongitude:h,positionFormat:g,modelMatrix:m,extensions:f,fetch:x,operation:y,_subLayerProps:v}=this.props,w={id:"",updateTriggers:{},opacity:o,pickable:n,visible:i,parameters:r,getPolygonOffset:s,highlightedObjectIndex:u,autoHighlight:l,highlightColor:c,coordinateSystem:d,coordinateOrigin:p,wrapLongitude:h,positionFormat:g,modelMatrix:m,extensions:f,fetch:x,operation:y},T=v&&t.id&&v[t.id],b=T&&T.updateTriggers,_=t.id||"sublayer";if(T){const e=this.props[a.Wb],o=t.type?t.type._propTypes:{};for(const t in T){const n=o[t]||e[t];n&&"accessor"===n.type&&(T[t]=this.getSubLayerAccessor(T[t]))}}Object.assign(w,t,T),w.id="".concat(this.props.id,"-").concat(_),w.updateTriggers={all:null===(e=this.props.updateTriggers)||void 0===e?void 0:e.all,...t.updateTriggers,...b};for(const t of f){const e=t.getSubLayerProps.call(this,t);e&&Object.assign(w,e,{updateTriggers:Object.assign(w.updateTriggers,e.updateTriggers)})}return w}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,e){let o=this.internalState.subLayers;const n=!o||this.needsUpdate();if(n){const t=this.renderLayers();o=(0,s.x)(t,Boolean),this.internalState.subLayers=o}(0,r.Z)("compositeLayer.renderLayers",this,n,o);for(const t of o)t.parent=this}}(0,n.Z)(u,"layerName","CompositeLayer")},34634:(t,e,o)=>{o.d(e,{F:()=>m});var n=o(18446),i=o.n(n),r=o(67294),s=o(90530),a=o(10025),u=o(85716),l=o(51995),c=o(32103),d=o(70917);const p=l.iK.div`
  ${({theme:t,top:e,left:o})=>`\n    position: absolute;\n    top: ${e}px;\n    left: ${o}px;\n    padding: ${2*t.gridUnit}px;\n    margin: ${2*t.gridUnit}px;\n    background: ${t.colors.grayscale.dark2};\n    color: ${t.colors.grayscale.light5};\n    maxWidth: 300px;\n    fontSize: ${t.typography.sizes.s}px;\n    zIndex: 9;\n    pointerEvents: none;\n  `}
`;function h(t){const{tooltip:e}=t;if(null==e)return null;const{x:o,y:n,content:i}=e,r="string"==typeof i?(0,c.Ul)(i):i;return(0,d.tZ)(p,{top:n,left:o},r)}const g=(0,r.memo)((0,r.forwardRef)(((t,e)=>{const[o,n]=(0,r.useState)(null),[l,c]=(0,r.useState)(null),[p,g]=(0,r.useState)(t.viewport),m=(0,u.D)(t.viewport);(0,r.useImperativeHandle)(e,(()=>({setTooltip:n})),[]);const f=(0,r.useCallback)((()=>{if(l&&Date.now()-l>250){const e=t.setControlValue;e&&e("viewport",p),c(null)}}),[l,t.setControlValue,p]);(0,r.useEffect)((()=>{const t=setInterval(f,250);return clearInterval(t)}),[f]),(0,r.useEffect)((()=>{i()(t.viewport,m)||g(t.viewport)}),[m,t.viewport]);const x=(0,r.useCallback)((({viewState:t})=>{g(t),c(Date.now())}),[]),y=(0,r.useCallback)((()=>t.layers.some((t=>"function"==typeof t))?t.layers.map((t=>"function"==typeof t?t():t)):t.layers),[t.layers]),{children:v=null,height:w,width:T}=t;return(0,d.tZ)(r.Fragment,null,(0,d.tZ)("div",{style:{position:"relative",width:T,height:w}},(0,d.tZ)(a.Z,{controller:!0,width:T,height:w,layers:y(),viewState:p,glOptions:{preserveDrawingBuffer:!0},onViewStateChange:x},(0,d.tZ)(s.Z3,{preserveDrawingBuffer:!0,mapStyle:t.mapStyle||"light",mapboxApiAccessToken:t.mapboxApiAccessToken})),v),(0,d.tZ)(h,{tooltip:o}))}))),m=(0,l.iK)(g)`
  .deckgl-tooltip > div {
    overflow: hidden;
    text-overflow: ellipsis;
  }
`},51805:(t,e,o)=>{o.d(e,{Z:()=>i}),o(67294);var n=o(70917);const i=({label:t,value:e})=>(0,n.tZ)("div",null,t,(0,n.tZ)("strong",null,e))},82527:(t,e,o)=>{o.r(e),o.d(e,{default:()=>G,getLayer:()=>H});var n=o(18446),i=o.n(n),r=o(4942),s=o(39450);const a=new Float32Array(12);function u(t,e=2){let o=0;for(const n of t)for(let t=0;t<e;t++)a[o++]=n[t]||0;return a}var l=o(6948),c=o(44211),d=o(4912),p=o(63346),h=o(53478),g=o(41576),m=o(33321),f=o(84287),x=o(39769),y=o(53982),v=o(5259),w=o(37832);class T extends v.Z{getShaders(){return{vs:"#define SHADER_NAME heatp-map-layer-vertex-shader\n\nuniform sampler2D maxTexture;\nuniform float intensity;\nuniform vec2 colorDomain;\nuniform float threshold;\nuniform float aggregationMode;\n\nattribute vec3 positions;\nattribute vec2 texCoords;\n\nvarying vec2 vTexCoords;\nvarying float vIntensityMin;\nvarying float vIntensityMax;\n\nvoid main(void) {\n  gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));\n  vTexCoords = texCoords;\n  vec4 maxTexture = texture2D(maxTexture, vec2(0.5));\n  float maxValue = aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;\n  float minValue = maxValue * threshold;\n  if (colorDomain[1] > 0.) {\n    maxValue = colorDomain[1];\n    minValue = colorDomain[0];\n  }\n  vIntensityMax = intensity / maxValue;\n  vIntensityMin = intensity / minValue;\n}\n",fs:"#define SHADER_NAME triangle-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D texture;\nuniform sampler2D colorTexture;\nuniform float aggregationMode;\n\nvarying vec2 vTexCoords;\nvarying float vIntensityMin;\nvarying float vIntensityMax;\n\nvec4 getLinearColor(float value) {\n  float factor = clamp(value * vIntensityMax, 0., 1.);\n  vec4 color = texture2D(colorTexture, vec2(factor, 0.5));\n  color.a *= min(value * vIntensityMin, 1.0);\n  return color;\n}\n\nvoid main(void) {\n  vec4 weights = texture2D(texture, vTexCoords);\n  float weight = weights.r;\n\n  if (aggregationMode > 0.5) {\n    weight /= max(1.0, weights.a);\n  }\n  if (weight <= 0.) {\n     discard;\n  }\n\n  vec4 linearColor = getLinearColor(weight);\n  linearColor.a *= opacity;\n  gl_FragColor =linearColor;\n}\n",modules:[w.Z]}}initializeState({gl:t}){this.getAttributeManager().add({positions:{size:3,noAlloc:!0},texCoords:{size:2,noAlloc:!0}}),this.setState({model:this._getModel(t)})}_getModel(t){const{vertexCount:e}=this.props;return new x.Z(t,{...this.getShaders(),id:this.props.id,geometry:new y.Z({drawMode:6,vertexCount:e})})}draw({uniforms:t}){const{model:e}=this.state,{texture:o,maxTexture:n,colorTexture:i,intensity:r,threshold:s,aggregationMode:a,colorDomain:u}=this.props;e.setUniforms({...t,texture:o,maxTexture:n,colorTexture:i,intensity:r,threshold:s,aggregationMode:a,colorDomain:u}).draw()}}(0,r.Z)(T,"layerName","TriangleLayer");var b=o(89033),_=o(79543);const S={mipmaps:!1,parameters:{10240:9729,10241:9729,10242:33071,10243:33071},dataFormat:6408},C=[0,0],M={SUM:0,MEAN:1},A={getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:_.K,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},L=[l.h.BLEND_EQUATION_MINMAX,l.h.TEXTURE_FLOAT],Z=[l.h.COLOR_ATTACHMENT_RGBA32F,l.h.FLOAT_BLEND],P={data:{props:["radiusPixels"]}};class D extends b.Z{constructor(...t){super(...t),(0,r.Z)(this,"state",void 0)}initializeState(){const{gl:t}=this.context;if(!(0,c.ag)(t,L))return this.setState({supported:!1}),void g.Z.error("HeatmapLayer: ".concat(this.id," is not supported on this browser"))();super.initializeAggregationLayer(P),this.setState({supported:!0,colorDomain:C}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState(t){this.state.supported&&(super.updateState(t),this._updateHeatmapState(t))}_updateHeatmapState(t){const{props:e,oldProps:o}=t,n=this._getChangeFlags(t);(n.dataChanged||n.viewportChanged)&&(n.boundsChanged=this._updateBounds(n.dataChanged),this._updateTextureRenderingBounds()),n.dataChanged||n.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):n.viewportZoomChanged&&this._debouncedUpdateWeightmap(),e.colorRange!==o.colorRange&&this._updateColorTexture(t),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:t.context.viewport.zoom})}renderLayers(){if(!this.state.supported)return[];const{weightsTexture:t,triPositionBuffer:e,triTexCoordBuffer:o,maxWeightsTexture:n,colorTexture:i,colorDomain:r}=this.state,{updateTriggers:s,intensity:a,threshold:u,aggregation:l}=this.props;return new(this.getSubLayerClass("triangle",T))(this.getSubLayerProps({id:"triangle-layer",updateTriggers:s}),{coordinateSystem:m.Df.DEFAULT,data:{attributes:{positions:e,texCoords:o}},vertexCount:4,maxTexture:n,colorTexture:i,aggregationMode:M[l]||0,texture:t,intensity:a,threshold:u,colorDomain:r})}finalizeState(t){super.finalizeState(t);const{weightsTransform:e,weightsTexture:o,maxWeightTransform:n,maxWeightsTexture:i,triPositionBuffer:r,triTexCoordBuffer:s,colorTexture:a,updateTimer:u}=this.state;null==e||e.delete(),null==o||o.delete(),null==n||n.delete(),null==i||i.delete(),null==r||r.delete(),null==s||s.delete(),null==a||a.delete(),u&&clearTimeout(u)}_getAttributeManager(){return new f.Z(this.context.gl,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(t){const e={},{dimensions:o}=this.state;e.dataChanged=this.isAttributeChanged()||this.isAggregationDirty(t,{compareAll:!0,dimension:o.data}),e.viewportChanged=t.changeFlags.viewportChanged;const{zoom:n}=this.state;return t.context.viewport&&t.context.viewport.zoom===n||(e.viewportZoomChanged=!0),e}_createTextures(){const{gl:t}=this.context,{textureSize:e,format:o,type:n}=this.state;this.setState({weightsTexture:new d.Z(t,{width:e,height:e,format:o,type:n,...S}),maxWeightsTexture:new d.Z(t,{format:o,type:n,...S})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:5130,accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{gl:t}=this.context,{weightsTextureSize:e}=this.props,o=Math.min(e,(0,s.ZS)(t,3379)),n=(0,c.ag)(t,Z),{format:i,type:r}=function({gl:t,floatTargetSupport:e}){return e?{format:(0,s.D0)(t)?34836:6408,type:5126}:{format:6408,type:5121}}({gl:t,floatTargetSupport:n}),a=n?1:1/255;this.setState({textureSize:o,format:i,type:r,weightsScale:a}),n||g.Z.warn("HeatmapLayer: ".concat(this.id," rendering to float texture not supported, fallingback to low precession format"))()}getShaders(t){return super.getShaders("max-weights-transform"===t?{vs:"attribute vec4 inTexture;\nvarying vec4 outTexture;\n\nvoid main()\n{\noutTexture = inTexture;\ngl_Position = vec4(0, 0, 0, 1.);\ngl_PointSize = 1.0;\n}\n",_fs:"varying vec4 outTexture;\nvoid main() {\n  gl_FragColor = outTexture;\n  gl_FragColor.g = outTexture.r / max(1.0, outTexture.a);\n}\n"}:{vs:"attribute vec3 positions;\nattribute vec3 positions64Low;\nattribute float weights;\nvarying vec4 weightsTexture;\nuniform float radiusPixels;\nuniform float textureWidth;\nuniform vec4 commonBounds;\nuniform float weightsScale;\nvoid main()\n{\n  weightsTexture = vec4(weights * weightsScale, 0., 0., 1.);\n\n  float radiusTexels  = project_pixel_size(radiusPixels) * textureWidth / (commonBounds.z - commonBounds.x);\n  gl_PointSize = radiusTexels * 2.;\n\n  vec3 commonPosition = project_position(positions, positions64Low);\n  gl_Position.xy = (commonPosition.xy - commonBounds.xy) / (commonBounds.zw - commonBounds.xy) ;\n  gl_Position.xy = (gl_Position.xy * 2.) - (1.);\n}\n",_fs:"varying vec4 weightsTexture;\nfloat gaussianKDE(float u){\n  return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);\n}\nvoid main()\n{\n  float dist = length(gl_PointCoord - vec2(0.5, 0.5));\n  if (dist > 0.5) {\n    discard;\n  }\n  gl_FragColor = weightsTexture * gaussianKDE(2. * dist);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"})}_createWeightsTransform(t={}){var e;const{gl:o}=this.context;let{weightsTransform:n}=this.state;const{weightsTexture:i}=this.state;null===(e=n)||void 0===e||e.delete(),n=new p.Z(o,{id:"".concat(this.id,"-weights-transform"),elementCount:1,_targetTexture:i,_targetTextureVarying:"weightsTexture",...t}),this.setState({weightsTransform:n})}_setupResources(){const{gl:t}=this.context;this._createTextures();const{textureSize:e,weightsTexture:o,maxWeightsTexture:n}=this.state,i=this.getShaders("weights-transform");this._createWeightsTransform(i);const r=this.getShaders("max-weights-transform"),s=new p.Z(t,{id:"".concat(this.id,"-max-weights-transform"),_sourceTextures:{inTexture:o},_targetTexture:n,_targetTextureVarying:"outTexture",...r,elementCount:e*e});this.setState({weightsTexture:o,maxWeightsTexture:n,maxWeightTransform:s,zoom:null,triPositionBuffer:new h.Z(t,{byteLength:48,accessor:{size:3}}),triTexCoordBuffer:new h.Z(t,{byteLength:48,accessor:{size:2}})})}updateShaders(t){this._createWeightsTransform(t)}_updateMaxWeightValue(){const{maxWeightTransform:t}=this.state;t.run({parameters:{blend:!0,depthTest:!1,blendFunc:[1,1],blendEquation:32776}})}_updateBounds(t=!1){const{viewport:e}=this.context,o=[e.unproject([0,0]),e.unproject([e.width,0]),e.unproject([e.width,e.height]),e.unproject([0,e.height])].map((t=>t.map(Math.fround))),n=function(t){const e=t.map((t=>t[0])),o=t.map((t=>t[1])),n=Math.min.apply(null,e),i=Math.max.apply(null,e);return[n,Math.min.apply(null,o),i,Math.max.apply(null,o)]}(o),i={visibleWorldBounds:n,viewportCorners:o};let r=!1;if(t||!this.state.worldBounds||(s=this.state.worldBounds,!((a=n)[0]>=s[0]&&a[2]<=s[2]&&a[1]>=s[1]&&a[3]<=s[3]))){const t=this._worldToCommonBounds(n),e=this._commonToWorldBounds(t);this.props.coordinateSystem===m.Df.LNGLAT&&(e[1]=Math.max(e[1],-85.051129),e[3]=Math.min(e[3],85.051129),e[0]=Math.max(e[0],-360),e[2]=Math.min(e[2],360));const o=this._worldToCommonBounds(e);i.worldBounds=e,i.normalizedCommonBounds=o,r=!0}var s,a;return this.setState(i),r}_updateTextureRenderingBounds(){const{triPositionBuffer:t,triTexCoordBuffer:e,normalizedCommonBounds:o,viewportCorners:n}=this.state,{viewport:i}=this.context;t.subData(u(n,3));const r=n.map((t=>function(t,e){const[o,n,i,r]=e;return[(t[0]-o)/(i-o),(t[1]-n)/(r-n)]}(i.projectPosition(t),o)));e.subData(u(r,2))}_updateColorTexture(t){const{colorRange:e}=t.props;let{colorTexture:o}=this.state;const n=(0,_.P)(e,!1,Uint8Array);o?o.setImageData({data:n,width:e.length}):o=new d.Z(this.context.gl,{data:n,width:e.length,height:1,...S}),this.setState({colorTexture:o})}_updateWeightmap(){const{radiusPixels:t,colorDomain:e,aggregation:o}=this.props,{weightsTransform:n,worldBounds:i,textureSize:r,weightsTexture:a,weightsScale:u}=this.state;this.state.isWeightMapDirty=!1;const l=this._worldToCommonBounds(i,{useLayerCoordinateSystem:!0});if(e&&"SUM"===o){const{viewport:t}=this.context,o=t.distanceScales.metersPerUnit[2]*(l[2]-l[0])/r;this.state.colorDomain=e.map((t=>t*o*u))}else this.state.colorDomain=e||C;const c={radiusPixels:t,commonBounds:l,textureWidth:r,weightsScale:u};n.update({elementCount:this.getNumInstances()}),(0,s.s8)(this.context.gl,{clearColor:[0,0,0,0]},(()=>{n.run({uniforms:c,parameters:{blend:!0,depthTest:!1,blendFunc:[1,1],blendEquation:32774},clearRenderTarget:!0,attributes:this.getAttributes(),moduleSettings:this.getModuleSettings()})})),this._updateMaxWeightValue(),a.setParameters({10240:9729,10241:9729})}_debouncedUpdateWeightmap(t=!1){let{updateTimer:e}=this.state;const{debounceTimeout:o}=this.props;t?(e=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(e),e=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),o)),this.setState({updateTimer:e})}_worldToCommonBounds(t,e={}){const{useLayerCoordinateSystem:o=!1}=e,[n,i,r,s]=t,{viewport:a}=this.context,{textureSize:u}=this.state,{coordinateSystem:l}=this.props,c=o&&(l===m.Df.LNGLAT_OFFSETS||l===m.Df.METER_OFFSETS),d=c?a.projectPosition(this.props.coordinateOrigin):[0,0],p=2*u/a.scale;let h,g;return o&&!c?(h=this.projectPosition([n,i,0]),g=this.projectPosition([r,s,0])):(h=a.projectPosition([n,i,0]),g=a.projectPosition([r,s,0])),function(t,e,o){const[n,i,r,s]=t,a=r-n,u=s-i;let l=a,c=u;a/u<e/o?l=e/o*u:c=o/e*a,l<e&&(l=e,c=o);const d=(r+n)/2,p=(s+i)/2;return[d-l/2,p-c/2,d+l/2,p+c/2]}([h[0]-d[0],h[1]-d[1],g[0]-d[0],g[1]-d[1]],p,p)}_commonToWorldBounds(t){const[e,o,n,i]=t,{viewport:r}=this.context,s=r.unprojectPosition([e,o]),a=r.unprojectPosition([n,i]);return s.slice(0,2).concat(a.slice(0,2))}}(0,r.Z)(D,"layerName","HeatmapLayer"),(0,r.Z)(D,"defaultProps",A);var B=o(67294),F=o(61988),z=o(45511),j=o(85716),E=o(58371),W=o(63241),N=o(89503),k=o(51805),R=o(40461),O=o(34634),I=o(70917);const U=({gradientStops:t,max:e,min:o})=>{const n=t.map((t=>`${t.color} ${t.value}%`)).join(", "),i=((t,e)=>{const o=[];return o.push(t),o.push(t/2),o.push(0),o.push(e/2),o.push(e),o.reverse()})(o,e),r={bar:{position:"absolute",top:"50px",left:"50px",width:"20px",height:"80%",backgroundImage:`linear-gradient(to top, ${n})`,borderRadius:"5px",border:"1px solid #000"},label:{position:"absolute",left:"60px",marginLeft:"12px",fontSize:"12px"}};return(0,I.tZ)("div",null,i.map(((t,e)=>(0,I.tZ)("div",{key:`point-${e}`,style:{...r.label,top:19*e+8+"%"}},t.toFixed(2)))),(0,I.tZ)("div",{style:r.bar}))},V=[];function $(t){const{data:e}=t.layer.props[Reflect.ownKeys(t.layer.props)[13]],o=function(t,e,o=5e-6,n=2e-5){for(const i of t){const[t,r]=i.position;if(Math.abs(t-e[0])<o&&Math.abs(r-e[1])<o)return i.weight;if(Math.abs(t-e[0])<n&&Math.abs(r-e[1])<n)return i.weight}return null}(e,t.coordinate);return o&&(0,I.tZ)("div",{className:"deckgl-tooltip"},(0,I.tZ)(k.Z,{label:(0,F.t)("Altitude"),value:` ${o}`}))}const H=(t,e,o,n)=>{var i,r,s,a,u,l,c,d;const p=t,{intensity:h=1,radius_pixels:g=30,aggregation:m="SUM",js_data_mutator:f,linear_color_scheme:x}=p;let y=e.data.features;f&&(y=(0,W.Z)(p.js_data_mutator)(y));const v=null==(i=(0,z.Z)())||null==(r=i.get(x))?void 0:r.createLinearScale([0,6]),w=null==v||null==(s=v.range())||null==(a=s.map((t=>(0,N.hexToRGB)(t))))?void 0:a.reverse(),T=null==(u=(0,z.Z)())||null==(l=u.get("schemeBuGn"))?void 0:l.createLinearScale([0,6]),b=null==T||null==(c=T.range())||null==(d=c.map((t=>(0,N.hexToRGB)(t))))?void 0:d.reverse();return[new D({id:`heatmp-pos-layer-${p.slice_id}`,data:y,intensity:h,radiusPixels:g,colorRange:w,aggregation:m.toUpperCase(),threshold:.1,getPosition:t=>t.position,getWeight:t=>(V.push(t.weight),t.weight>0?t.weight:0),...(0,E.N)(p,n,$)}),new D({id:`heatmp-neg-layer-${p.slice_id}`,data:y,intensity:h,radiusPixels:g,colorRange:b,aggregation:m.toUpperCase(),threshold:.1,getPosition:t=>t.position,getWeight:t=>(V.push(t.weight),t.weight<0?-t.weight:0),...(0,E.N)(p,n,$)})]},K=[{color:"#0000FF",value:0},{color:"#0048B6",value:20},{color:"#00B648",value:40},{color:"#00FF00",value:50},{color:"#ffbf00",value:60},{color:"#ff7f00",value:80},{color:"red",value:100}],G=function(t,e){return(0,B.memo)((e=>{const o=(0,B.useRef)(),n=(0,j.D)(e.formData),r=(0,j.D)(e.payload),[s,a]=(0,B.useState)([]),[u,l]=(0,B.useState)((()=>{const{width:t,height:o,formData:n}=e;return n.autozoom?(0,R.Z)(e.viewport,{width:t,height:o,points:(i=e.payload.data.features,i.map((t=>t.position)))}):e.viewport;var i})()),c=(0,B.useCallback)((t=>{const{current:e}=o;e&&(null==e||e.setTooltip(t))}),[]),d=(0,B.useCallback)((e=>{const{formData:o,payload:n,onAddFilter:i}=e;return t(o,n,i,c)}),[c]),[p,h]=(0,B.useState)(d(e));(0,B.useEffect)((()=>{const t={...n,viewport:null},o={...e.formData,viewport:null};i()(t,o)&&r===e.payload||(h(d(e)),a(e.payload.data.features.map((t=>t.weight))))}),[d,n,r,e]);const{formData:g,payload:m,setControlValue:f,height:x,width:y}=e,[v,w]=(0,B.useState)(Number.MAX_VALUE),[T,b]=(0,B.useState)(Number.MIN_VALUE);return(0,B.useEffect)((()=>{if(s.length>0){const t=Math.min(...s),e=Math.max(...s);w(t),b(e)}}),[s]),(0,I.tZ)("div",{style:{position:"relative"}},(0,I.tZ)(O.F,{ref:o,mapboxApiAccessToken:m.data.mapboxApiKey,viewport:u,layers:[p],mapStyle:g.mapbox_style,setControlValue:f,width:y,height:x,onViewportChange:l}),(0,I.tZ)(U,{gradientStops:K,max:T,min:v}))}))}(H)},58371:(t,e,o)=>{o.d(e,{N:()=>r,Z:()=>a});var n=o(4065),i=o(63241);function r(t,e,o,n){const r=t;let s,a,u=o;return r.js_tooltip&&(u=(0,i.Z)(r.js_tooltip)),u&&(s=t=>(t.picked?e({content:u(t),x:t.x,y:t.y}):e(null),!0)),r.js_onclick_href?a=t=>{const e=(0,i.Z)(r.js_onclick_href)(t);return window.open(e),!0}:r.table_filter&&void 0!==n&&(a=t=>(n(t.object[r.line_column]),!0)),{onClick:a,onHover:s,pickable:Boolean(s)}}const s={p1:.01,p5:.05,p95:.95,p99:.99};function a(t="sum",e=null){if("count"===t)return t=>t.length;let o;return o=t in s?(o,i)=>{let r;return r=e?o.sort(((t,o)=>n.ascending(e(t),e(o)))):o.sort(n.ascending),n.quantile(r,s[t],i)}:n[t],e?t=>o(t.map((t=>e(t)))):t=>o(t)}},89503:(t,e,o)=>{o.r(e),o.d(e,{hexToRGB:()=>i});var n=o(50667);function i(t,e=255){if(!t)return[0,0,0,e];const{r:o,g:i,b:r}=(0,n.B8)(t);return[o,i,r,e]}},40461:(t,e,o)=>{o.d(e,{Z:()=>u});var n=o(17013),i=o(4065);const r=[-90,90],s=[-180,180];function a([t,e],[o,n],i=.25){return t<e?[t,e]:[Math.max(o,t-i),Math.min(n,e+i)]}function u(t,{points:e,width:o,height:u,minExtent:l,maxZoom:c,offset:d,padding:p=20}){const{bearing:h,pitch:g}=t,m=function(t){const e=a((0,i.extent)(t,(t=>t[1])),r),o=a((0,i.extent)(t,(t=>t[0])),s);return[[o[0],e[0]],[o[1],e[1]]]}(e);try{return{...(0,n.Xg)({bounds:m,width:o,height:u,minExtent:l,maxZoom:c,offset:d,padding:p}),bearing:h,pitch:g}}catch(t){console.error("Could not fit viewport",t)}return t}},63241:(t,e,o)=>{o.d(e,{Z:()=>l});var n=o(55140),i=o.n(n),r=o(59050),s=o(4065),a=o(89503);const u={console,_:r.ZP,colors:a,d3array:s};function l(t,e,o){const n={},r=`SAFE_EVAL_${Math.floor(1e6*Math.random())}`;n[r]={};const s=`${r}=${t}`,a={...u,...e};Object.keys(a).forEach((t=>{n[t]=a[t]}));try{return i().runInNewContext(s,n,o),n[r]}catch(t){return()=>t}}}}]);
//# sourceMappingURL=7046d825b917da26b812.chunk.js.map